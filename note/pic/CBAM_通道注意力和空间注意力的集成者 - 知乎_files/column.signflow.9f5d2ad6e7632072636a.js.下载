(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{1398:function(e,t,n){"use strict";n.d(t,"b",(function(){return o}));var a=n(40),r={400:"请求参数有误",401:"用户认证失败",403:"服务已拒绝",404:"资源不存在",405:"请求方式有误",410:"资源已解散",502:"网关错误",503:"服务无响应",504:"网关超时"},o=function(e){var t;return(null==e||null===(t=e.payload)||void 0===t?void 0:t.message)||(null==e?void 0:e.status)&&r[e.status]||"操作失败"};t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(a.a)("ui/showToast").dispatch({icon:"fail",text:o(e)})}},1399:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return d}));var a=n(0),r=n(1),o=n(54),i=n.n(o),c=function(e){return console.error("该组件没有设置 LoginV2ContextProvider，使用的是默认 Context value。"),e},s={get captchaNeeded(){return c(!1)},get captchaV2(){return c(void 0)},get captchaV2Ref(){return c({current:null})},get continueActionRef(){return c({current:null})},get handleChange(){return c(i.a)},get handleChangeType(){return c(i.a)},get handleSendDigits(){return c(i.a)},get selectClassName(){return c("")},get setState(){return c(i.a)},get testPhoneNo(){return c(i.a)}},u=Object(r.createContext)(s),l=function(){return Object(r.useContext)(u)},d=function(e){var t=e.handleChangeType,n=e.setState,o=e.handleChange,i=e.testPhoneNo,c=e.handleSendDigits,s=e.continueActionRef,l=e.captchaV2Ref,d=e.captchaNeeded,h=e.selectClassName,p=e.captchaV2,f=e.children,g=Object(r.useMemo)((function(){return{handleChangeType:t,handleChange:o,testPhoneNo:i,handleSendDigits:c,selectClassName:h,setState:n,continueActionRef:s,captchaV2Ref:l,captchaNeeded:d,captchaV2:p}}),[t,o,i,c,h,n,s,l,d,p]);return Object(a.b)(u.Provider,{value:g,children:f})}},1419:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var a=n(24),r=n(4),o=n(11),i=n(12),c=n(13),s=n(14),u=n(15),l=n(6),d=n(0),h=n(2),p=n.n(h),f=n(1),g=n(46),b=n(10),m=n(536),A=n.n(m),v=n(89),C=n.n(v);function E(e,t){return t?e.trim():e}var w={useTrim:!0},O={required:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w,n=t.useTrim;return""!==E(e,n)},maxLength:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w,a=n.useTrim;return E(e,a).length<=t},minLength:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w,a=n.useTrim;return E(e,a).length>=t},pattern:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w,a=n.useTrim;return t.test(E(e,a))}};function y(){return function(e){return function(e){var t=e.contextTypes,n=e.defaultProps,a=Object.assign({},e.prototype);function r(e){for(var t=a[e],n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return"function"==typeof t?t.apply(void 0,r):void 0}return Object.assign(e.prototype,{UNSAFE_componentWillMount:function(){var e=this.context.form;e&&(e.attachToForm(this),this.setState({_value:"",_validations:[]}));for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return r.apply(void 0,["componentWillMount"].concat(n))},componentWillUnmount:function(){var e=this.context.form;e&&e.detachFromForm(this);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return r.apply(void 0,["componentWillUnmount"].concat(n))},getValue:function(){var e=(this.state||{})._value;return null==e?"":e},setValue:function(e,t){this.setState({_value:e},(function(){"function"==typeof t&&t()}))},getValidationMessage:function(){var e=this.getValidationMessages();return e&&e[0]},getValidationClassName:function(){var e=(this.state||{})._validations;return e&&e[0]&&e[0].className},getValidationMessages:function(){var e=(this.state||{})._validations;return null==e?void 0:e.map((function(e){var t=e.message;return t?"string"==typeof t?t:t.message||"未知错误":""}))},setValidations:function(e){var t=this;this.setState({_validations:e},(function(){return t.forceUpdate()}))},clearValidations:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=this.state||{},a=n._validations;a&&a.length>0&&this.setState(Object.assign(Object.assign({},e),{},{_validations:[]}),t)},addValidation:function(e){this.setState((function(t){var n=t._validations;return{_validations:[e].concat(Object(o.a)(n||[]))}}))},addManualValidation:function(e){this.addValidation({type:"manual",message:e})},validate:function(){this.context.form.validate(this)}}),Object.assign(e,{contextTypes:Object.assign(Object.assign({},t),{},{form:p.a.object}),defaultProps:Object.assign(Object.assign({},n),{},{validations:[]})}),e}(e)}}var S=["children","onRef"];function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(l.a)(e);if(t){var r=Object(l.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(u.a)(this,n)}}var I=function(e){Object(s.a)(n,e);var t=j(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,c=new Array(a),s=0;s<a;s++)c[s]=arguments[s];return(e=t.call.apply(t,[this].concat(c))).state={isValid:!0},e.inputs=[],e.attachToForm=function(t){var n=t.props.name;if(!n||e.inputs.includes(n))throw new Error("form input must specify a unqie name, but current is ".concat(n));e.inputs.push(t)},e.detachFromForm=function(t){var n=e.inputs.indexOf(t);-1!==n&&(e.inputs=[].concat(Object(o.a)(e.inputs.slice(0,n)),Object(o.a)(e.inputs.slice(n+1))))},e.validate=function(e){var t=e.state._value,n=e.props.validations,a=[],r=[];return n?(!Array.isArray(n)&&n.type&&(n=[n]),n.forEach((function(e){var n=e.type,i=e.value,c=e.options,s=O[n];if(!s)throw new Error("no ".concat(n," rules, please define it at Form.validateRules"));var u=s(t,i,c);A()(u)?r=[].concat(Object(o.a)(r),[u.then((function(){}),(function(){a.push(e)}))]):u||(a=[].concat(Object(o.a)(a),[e]))})),Promise.all(r).then((function(){return e.setValidations(a),a}))):a},e.handleSubmit=function(t){t.preventDefault();var n=e.props,a=n.onPreSubmit,o=n.onSubmit,i=n.isWechat;a(),i?new Promise((function(t){var n=e.inputs.find((function(e){return"username"===e.props.name}));n&&!n.state._value&&Object(g.findDOMNode)(n.inputEl).value&&n.handleChange({target:{value:Object(g.findDOMNode)(n.inputEl).value}});var a=e.inputs.find((function(e){return"password"===e.props.name}));a&&!a.state._value&&n&&Object(g.findDOMNode)(n.inputEl).value&&a.handleChange({target:{value:Object(g.findDOMNode)(a.inputEl).value}}),t()})).then((function(){e.validateAll().then((function(t){if(t){var n=e.inputs.reduce((function(e,t){return Object.assign(Object.assign({},e),{},Object(r.a)({},t.props.name,t.state._value))}),{});o(n)}}))})):e.validateAll().then((function(t){if(t){var n=e.inputs.reduce((function(e,t){return Object.assign(Object.assign({},e),{},Object(r.a)({},t.props.name,t.state._value))}),{});o(n)}}))},e}return Object(c.a)(n,[{key:"getChildContext",value:function(){return{form:{attachToForm:this.attachToForm,detachFromForm:this.detachFromForm,getValue:this.getValue,setValue:this.setValue,validate:this.validate}}}},{key:"componentDidMount",value:function(){}},{key:"validateAll",value:function(){var e=this,t=this.props,n=t.onValid,a=t.onInvalid,r=[],i=[];return this.inputs.forEach((function(t){var n=e.validate(t);A()(n)?i=[].concat(Object(o.a)(i),[n.then((function(e){r=[].concat(Object(o.a)(r),Object(o.a)(e))}))]):n&&(r=[].concat(Object(o.a)(r),Object(o.a)(n)))})),Promise.all(i).then((function(){var t=0===r.length;return e.setState({isValid:t},(function(){t?n():a(r.map((function(e){return e.message})))})),t}))}},{key:"render",value:function(){var e=C()(this.props,["onValid","onInvalid","onSubmit","onPreSubmit","isWechat","dispatch"]),t=e.children,n=e.onRef,r=Object(a.default)(e,S);return Object(d.b)("form",Object.assign(Object.assign({noValidate:!0,onSubmit:this.handleSubmit,ref:n},r),{},{children:t}))}}]),n}(f.Component);I.childContextTypes={form:p.a.object},I.propTypes={onValid:p.a.func,onInvalid:p.a.func,onSubmit:p.a.func,onPreSubmit:p.a.func},I.validateRules=O,I.defaultProps={onValid:function(){},onInvalid:function(){},onSubmit:function(){},onPreSubmit:function(){}};t.b=Object(b.connect)((function(e){return{isWechat:e.env.userAgent.Wechat}}))(I)},1420:function(e,t,n){"use strict";var a=n(4),r=n(24),o=n(12),i=n(13),c=n(14),s=n(15),u=n(6),l=n(0),d=n(2),h=n.n(d),p=n(1),f=n(7),g=n.n(f),b=n(89),m=n.n(b),A=n(105),v=n(1419),C=["className","inputClassName","errorMessageClassName"];function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(u.a)(e);if(t){var r=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(s.a)(this,n)}}var w=function(e){Object(c.a)(n,e);var t=E(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).handleErrorHide=function(){e.getValidationMessage()&&e.setState({errorMaskShown:!1},(function(){e.clearValidations({errorMaskShown:!0},(function(){return e.inputEl.focus()}))}))},e.handleKeyUp=function(t){8!==t.keyCode&&9!==t.keyCode||e.clearValidations()},e.handleChange=function(t){var n=t.target.value,a=e.props.onChange;e.setValue(n),"function"==typeof a&&a(n)},e}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.defaultValue;e&&this.setValue(e),this.setState({errorMaskShown:!0})}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props,n=t.manualValidateError,a=t.type,r=t.smsType,o=e.manualValidateError,i=e.type,c=e.defaultValue,s=e.smsType;!n&&o||"string"==typeof n&&n!==o?this.addManualValidation(o):n&&!o&&this.clearValidations({errorMaskShown:!0}),a===i&&r===s||(this.setValue(c),this.clearValidations({errorMaskShown:!0}))}},{key:"render",value:function(){var e,t=this,n=m()(this.props,["validations","defaultValue","onChange","smsType","manualValidateError","dispatch"]),o=n.className,i=n.inputClassName,c=n.errorMessageClassName,s=Object(r.default)(n,C),u=(this.state||{}).errorMaskShown,d=this.getValue(),h=this.getValidationMessage();return Object(l.c)("div",{className:g()("SignFlowInput",o),children:[Object(l.b)(A.a,Object.assign({onRef:function(e){t.inputEl=e},value:d,onChange:this.handleChange,onKeyUp:this.handleKeyUp,onClick:this.handleErrorHide,onBlur:function(){return t.validate()},className:i},s)),Object(l.b)("div",{className:g()("SignFlowInput-errorMask",this.getValidationClassName(),(e={},Object(a.a)(e,c,h),Object(a.a)(e,"SignFlowInput-requiredErrorMask",!d),Object(a.a)(e,"SignFlowInput-errorMask--hidden",!h||!u),e)),onClick:this.handleErrorHide,children:h})]})}}]),n}(p.Component);w.propTypes={inputClassName:h.a.string,errorMessageClassName:h.a.string,manualValidateError:h.a.node};t.a=Object(v.a)()(w)},1432:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return s}));var a=n(24),r=n(7),o=n.n(r),i=["className","label","tabIndex"];function c(e){return"Enter"===e.key||" "===e.key||"Enter"===e.code||"Space"===e.code||13===e.keyCode||32===e.keyCode}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.className,r=t.label,s=void 0===r?"":r,u=t.tabIndex,l=void 0===u?0:u,d=Object(a.default)(t,i);return Object.assign(Object.assign({role:"button",tabIndex:l,onClick:e,onKeyDown:function(t){c(t)&&e(t)},className:o()("a11y-button",n)},s&&{"aria-label":s}),d)}},1460:function(e,t,n){"use strict";var a=n(24),r=n(12),o=n(13),i=n(14),c=n(15),s=n(6),u=n(0),l=n(2),d=n.n(l),h=n(1),p=n(10),f=n(132),g=n(89),b=n.n(g),m=n(1399),A=n(366),v=n(1420),C=n(16),E=n(1318);function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}h.Component;var O=["supportedCountries","onChange","defaultPhoneNo","type","defaultSelectedCountry","supportedCountriesShown","placeholderPrefix","getPlaceholder","selectClassName"];function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var S=function(e){Object(i.a)(n,e);var t=y(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={selectedCountry:null},e.handleSelect=function(t,n){var a=e.props,r=a.supportedCountries,o=a.onSelect,i=r[n];e.setState({selectedCountry:i}),o(i)},e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.supportedCountries,n=e.getSupportedCountries;t&&t.length||n()}},{key:"render",value:function(){var e=b()(this.props,["getSupportedCountries","onSelect"]),t=e.supportedCountries,n=e.onChange,r=e.defaultPhoneNo,o=e.type,i=e.defaultSelectedCountry,c=e.supportedCountriesShown,s=e.placeholderPrefix,l=void 0===s?"":s,d=e.getPlaceholder,h=e.selectClassName,p=Object(a.default)(e,O),g=this.state.selectedCountry||i,m=g.name,A=g.code,C=Boolean(c&&t&&t.length);return Object(u.c)("div",{className:"SignFlow-account",children:[C&&Object(u.c)(u.a,{children:[Object(u.b)("div",{className:"SignFlow-supportedCountriesSelectContainer",children:Boolean(t)&&Boolean(t.length)&&Object(u.b)(f.b,{plain:!0,targetClassName:h,text:"".concat(m," ").concat(A),onChange:this.handleSelect,children:t.map((function(e,t){var n=e.name,a=e.code;return Object(u.b)(f.a,{value:"".concat(n," ").concat(a)},t)}))})}),Object(u.b)("span",{className:"SignFlow-accountSeperator",children:" "})]}),Object(u.b)(v.a,Object.assign({className:"SignFlow-accountInputContainer",name:"register"===o?"phoneNo":"username",inputClassName:"SignFlow-accountInput",placeholder:d(o,l),onChange:n,defaultValue:r,validations:[{type:"required",message:d(o,"请输入")}],type:"digits"===o||"register"===o?"tel":"text"},p))]})}}]),n}(h.Component);S.propTypes={defaultPhoneNo:d.a.string,defaultSelectedCountry:d.a.object,supportedCountries:d.a.array,onSelect:d.a.func,onChange:d.a.func,getSupportedCountries:d.a.func,type:d.a.oneOf(["register","digits","password"]).isRequired,supportedCountriesShown:d.a.bool,placeholderPrefix:d.a.string,getPlaceholder:d.a.func},S.defaultProps={defaultPhoneNo:"",defaultSelectedCountry:{name:"中国",code:"+86"},supportedCountriesShown:!0,getPlaceholder:function(e,t){var n="digits"===e||"register"===e?"手机号":"手机号或邮箱";return"".concat(t).concat(n)}};t.a=Object(p.connect)((function(e){return{supportedCountries:e.sms.supportedCountries}}),{getSupportedCountries:A.b})((function(e){var t=Object(m.b)().selectClassName;return Object(u.b)(S,Object.assign(Object.assign({},e),{},{selectClassName:t}))}))},1496:function(e,t,n){"use strict";function a(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return function(){for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];var o=a[a.length-1]||{};return n.reduce((function(t,n,r){return t.concat(Number.isInteger(n)&&a[n]||o[n],e[r+1])}),[e[0]]).join("")}}n.d(t,"a",(function(){return a}))},1559:function(e,t,n){"use strict";var a=n(24),r=n(12),o=n(13),i=n(14),c=n(15),s=n(6),u=n(0),l=n(2),d=n.n(l),h=n(1),p=n(7),f=n.n(p),g=n(18),b=n(89),m=n.n(b),A=["className","disabled"];function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var C=function(e){Object(i.a)(n,e);var t=v(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).clearTimer=function(){a.timer&&window.clearInterval(a.timer)},a.handleClick=function(e){a.state.isCounting||a.startTiming(e)},a.state={countDownTime:e.countDownTime,isCounting:!1},a.isInitialState=!0,a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.props.startAtOnce&&this.startTiming()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props,n=t.interceptTime,a=t.reStartTime,r=e.interceptTime,o=e.reStartTime;n!==r&&this.resetTiming(),a!==o&&(this.resetTiming(),this.startTiming())}},{key:"componentWillUnmount",value:function(){this.clearTimer()}},{key:"resetTiming",value:function(){this.clearTimer(),this.setState({countDownTime:this.props.countDownTime,isCounting:!1})}},{key:"startTiming",value:function(e){var t=this,n=this.props,a=n.event,r=n.countDownEndEvent,o=null,i=function(){t.isInitialState=!1,t.setState({isCounting:!0}),t.timer=setInterval((function(){var e=t.state.countDownTime;e<=0?(r&&r(),t.resetTiming()):t.setState({countDownTime:e-1})}),1e3)};"function"==typeof a&&(o=a(e,i)),!1!==o&&i()}},{key:"renderText",value:function(){var e=this.props,t=e.initialText,n=e.resetText,a=e.countingText,r=this.state,o=r.countDownTime;return r.isCounting?a({count:o}):this.isInitialState?t:n||t}},{key:"render",value:function(){var e=m()(this.props,["initialText","resetText","countingText","startAtOnce","countDownTime","event","interceptTime","countDownEndEvent","reStartTime"]),t=e.className,n=e.disabled,r=Object(a.default)(e,A),o=this.state.isCounting;return Object(u.b)(g.c,Object.assign(Object.assign({className:f()("CountingDownButton",t,{"is-counting":o})},r),{},{onClick:this.handleClick,disabled:n||o,children:this.renderText()}))}}]),n}(h.Component);C.propTypes={countDownTime:d.a.number,startAtOnce:d.a.bool,initialText:d.a.string.isRequired,resetText:d.a.string,countingText:d.a.func.isRequired,event:d.a.func,countDownEndEvent:d.a.func,interceptTime:d.a.number,reStartTime:d.a.number},C.defaultProps={countDownTime:60,startAtOnce:!1,interceptTime:-1,reStartTime:-1};t.a=C},1571:function(e,t,n){"use strict";var a;!function(r){function o(e,t,n){var a,r,o,i,c,g,b,m,A,v=0,C=[],E=0,w=!1,O=[],y=[],S=!1,j=!1,I=-1;if(a=(n=n||{}).encoding||"UTF8",(A=n.numRounds||1)!==parseInt(A,10)||1>A)throw Error("numRounds must a integer >= 1");if("SHA-1"===e)c=512,g=V,b=z,i=160,m=function(e){return e.slice()};else if(0===e.lastIndexOf("SHA-",0))if(g=function(t,n){return q(t,n,e)},b=function(t,n,a,r){var o,i;if("SHA-224"===e||"SHA-256"===e)o=15+(n+65>>>9<<4),i=16;else{if("SHA-384"!==e&&"SHA-512"!==e)throw Error("Unexpected error in SHA-2 implementation");o=31+(n+129>>>10<<5),i=32}for(;t.length<=o;)t.push(0);for(t[n>>>5]|=128<<24-n%32,n+=a,t[o]=4294967295&n,t[o-1]=n/4294967296|0,a=t.length,n=0;n<a;n+=i)r=q(t.slice(n,n+i),r,e);if("SHA-224"===e)t=[r[0],r[1],r[2],r[3],r[4],r[5],r[6]];else if("SHA-256"===e)t=r;else if("SHA-384"===e)t=[r[0].a,r[0].b,r[1].a,r[1].b,r[2].a,r[2].b,r[3].a,r[3].b,r[4].a,r[4].b,r[5].a,r[5].b];else{if("SHA-512"!==e)throw Error("Unexpected error in SHA-2 implementation");t=[r[0].a,r[0].b,r[1].a,r[1].b,r[2].a,r[2].b,r[3].a,r[3].b,r[4].a,r[4].b,r[5].a,r[5].b,r[6].a,r[6].b,r[7].a,r[7].b]}return t},m=function(e){return e.slice()},"SHA-224"===e)c=512,i=224;else if("SHA-256"===e)c=512,i=256;else if("SHA-384"===e)c=1024,i=384;else{if("SHA-512"!==e)throw Error("Chosen SHA variant is not supported");c=1024,i=512}else{if(0!==e.lastIndexOf("SHA3-",0)&&0!==e.lastIndexOf("SHAKE",0))throw Error("Chosen SHA variant is not supported");var B=6;if(g=L,m=function(e){var t,n=[];for(t=0;5>t;t+=1)n[t]=e[t].slice();return n},I=1,"SHA3-224"===e)c=1152,i=224;else if("SHA3-256"===e)c=1088,i=256;else if("SHA3-384"===e)c=832,i=384;else if("SHA3-512"===e)c=576,i=512;else if("SHAKE128"===e)c=1344,i=-1,B=31,j=!0;else{if("SHAKE256"!==e)throw Error("Chosen SHA variant is not supported");c=1088,i=-1,B=31,j=!0}b=function(e,t,n,a,r){var o,i=B,s=[],u=(n=c)>>>5,l=0,d=t>>>5;for(o=0;o<d&&t>=n;o+=u)a=L(e.slice(o,o+u),a),t-=n;for(e=e.slice(o),t%=n;e.length<u;)e.push(0);for(e[(o=t>>>3)>>2]^=i<<o%4*8,e[u-1]^=2147483648,a=L(e,a);32*s.length<r&&(e=a[l%5][l/5|0],s.push(e.b),!(32*s.length>=r));)s.push(e.a),0==64*(l+=1)%n&&(L(null,a),l=0);return s}}o=f(t,a,I),r=F(e),this.setHMACKey=function(t,n,o){var s;if(!0===w)throw Error("HMAC key already set");if(!0===S)throw Error("Cannot set HMAC key after calling update");if(!0===j)throw Error("SHAKE is not supported for HMAC");for(t=(n=f(n,a=(o||{}).encoding||"UTF8",I)(t)).binLen,n=n.value,o=(s=c>>>3)/4-1,s<t/8&&(n=b(n,t,0,F(e),i));n.length<=o;)n.push(0);for(t=0;t<=o;t+=1)O[t]=909522486^n[t],y[t]=1549556828^n[t];r=g(O,r),v=c,w=!0},this.update=function(e){var t,n,a,i=0,s=c>>>5;for(e=(t=o(e,C,E)).binLen,n=t.value,t=e>>>5,a=0;a<t;a+=s)i+c<=e&&(r=g(n.slice(a,a+s),r),i+=c);v+=i,C=n.slice(i>>>5),E=e%c,S=!0},this.getHash=function(t,n){var a,o,c,f;if(!0===w)throw Error("Cannot call getHash after setting HMAC key");if(c=p(n),!0===j){if(-1===c.shakeLen)throw Error("shakeLen must be specified in options");i=c.shakeLen}switch(t){case"HEX":a=function(e){return s(e,i,I,c)};break;case"B64":a=function(e){return u(e,i,I,c)};break;case"BYTES":a=function(e){return l(e,i,I)};break;case"ARRAYBUFFER":try{o=new ArrayBuffer(0)}catch(e){throw Error("ARRAYBUFFER not supported by this environment")}a=function(e){return d(e,i,I)};break;case"UINT8ARRAY":try{o=new Uint8Array(0)}catch(e){throw Error("UINT8ARRAY not supported by this environment")}a=function(e){return h(e,i,I)};break;default:throw Error("format must be HEX, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}for(f=b(C.slice(),E,v,m(r),i),o=1;o<A;o+=1)!0===j&&0!=i%32&&(f[f.length-1]&=16777215>>>24-i%32),f=b(f,i,0,F(e),i);return a(f)},this.getHMAC=function(t,n){var a,o,f,A;if(!1===w)throw Error("Cannot call getHMAC without first setting HMAC key");switch(f=p(n),t){case"HEX":a=function(e){return s(e,i,I,f)};break;case"B64":a=function(e){return u(e,i,I,f)};break;case"BYTES":a=function(e){return l(e,i,I)};break;case"ARRAYBUFFER":try{a=new ArrayBuffer(0)}catch(e){throw Error("ARRAYBUFFER not supported by this environment")}a=function(e){return d(e,i,I)};break;case"UINT8ARRAY":try{a=new Uint8Array(0)}catch(e){throw Error("UINT8ARRAY not supported by this environment")}a=function(e){return h(e,i,I)};break;default:throw Error("outputFormat must be HEX, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}return o=b(C.slice(),E,v,m(r),i),A=g(y,F(e)),a(A=b(o,i,c,A,i))}}function i(e,t){this.a=e,this.b=t}function c(e,t,n,a){var r,o,i,c,s;for(t=t||[0],o=(n=n||0)>>>3,s=-1===a?3:0,r=0;r<e.length;r+=1)i=(c=r+o)>>>2,t.length<=i&&t.push(0),t[i]|=e[r]<<8*(s+c%4*a);return{value:t,binLen:8*e.length+n}}function s(e,t,n,a){var r,o,i,c="";for(t/=8,i=-1===n?3:0,r=0;r<t;r+=1)o=e[r>>>2]>>>8*(i+r%4*n),c+="0123456789abcdef".charAt(o>>>4&15)+"0123456789abcdef".charAt(15&o);return a.outputUpper?c.toUpperCase():c}function u(e,t,n,a){var r,o,i,c,s="",u=t/8;for(c=-1===n?3:0,r=0;r<u;r+=3)for(o=r+1<u?e[r+1>>>2]:0,i=r+2<u?e[r+2>>>2]:0,i=(e[r>>>2]>>>8*(c+r%4*n)&255)<<16|(o>>>8*(c+(r+1)%4*n)&255)<<8|i>>>8*(c+(r+2)%4*n)&255,o=0;4>o;o+=1)s+=8*r+6*o<=t?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>>6*(3-o)&63):a.b64Pad;return s}function l(e,t,n){var a,r,o,i="";for(t/=8,o=-1===n?3:0,a=0;a<t;a+=1)r=e[a>>>2]>>>8*(o+a%4*n)&255,i+=String.fromCharCode(r);return i}function d(e,t,n){t/=8;var a,r,o,i=new ArrayBuffer(t);for(o=new Uint8Array(i),r=-1===n?3:0,a=0;a<t;a+=1)o[a]=e[a>>>2]>>>8*(r+a%4*n)&255;return i}function h(e,t,n){t/=8;var a,r,o=new Uint8Array(t);for(r=-1===n?3:0,a=0;a<t;a+=1)o[a]=e[a>>>2]>>>8*(r+a%4*n)&255;return o}function p(e){var t={outputUpper:!1,b64Pad:"=",shakeLen:-1};if(e=e||{},t.outputUpper=e.outputUpper||!1,!0===e.hasOwnProperty("b64Pad")&&(t.b64Pad=e.b64Pad),!0===e.hasOwnProperty("shakeLen")){if(0!=e.shakeLen%8)throw Error("shakeLen must be a multiple of 8");t.shakeLen=e.shakeLen}if("boolean"!=typeof t.outputUpper)throw Error("Invalid outputUpper formatting option");if("string"!=typeof t.b64Pad)throw Error("Invalid b64Pad formatting option");return t}function f(e,t,n){switch(t){case"UTF8":case"UTF16BE":case"UTF16LE":break;default:throw Error("encoding must be UTF8, UTF16BE, or UTF16LE")}switch(e){case"HEX":e=function(e,t,a){var r,o,i,c,s,u,l=e.length;if(0!=l%2)throw Error("String of HEX type must be in byte increments");for(t=t||[0],s=(a=a||0)>>>3,u=-1===n?3:0,r=0;r<l;r+=2){if(o=parseInt(e.substr(r,2),16),isNaN(o))throw Error("String of HEX type contains invalid characters");for(i=(c=(r>>>1)+s)>>>2;t.length<=i;)t.push(0);t[i]|=o<<8*(u+c%4*n)}return{value:t,binLen:4*l+a}};break;case"TEXT":e=function(e,a,r){var o,i,c,s,u,l,d,h,p=0;if(a=a||[0],u=(r=r||0)>>>3,"UTF8"===t)for(h=-1===n?3:0,c=0;c<e.length;c+=1)for(i=[],128>(o=e.charCodeAt(c))?i.push(o):2048>o?(i.push(192|o>>>6),i.push(128|63&o)):55296>o||57344<=o?i.push(224|o>>>12,128|o>>>6&63,128|63&o):(c+=1,o=65536+((1023&o)<<10|1023&e.charCodeAt(c)),i.push(240|o>>>18,128|o>>>12&63,128|o>>>6&63,128|63&o)),s=0;s<i.length;s+=1){for(l=(d=p+u)>>>2;a.length<=l;)a.push(0);a[l]|=i[s]<<8*(h+d%4*n),p+=1}else if("UTF16BE"===t||"UTF16LE"===t)for(h=-1===n?2:0,i="UTF16LE"===t&&1!==n||"UTF16LE"!==t&&1===n,c=0;c<e.length;c+=1){for(o=e.charCodeAt(c),!0===i&&(o=(s=255&o)<<8|o>>>8),l=(d=p+u)>>>2;a.length<=l;)a.push(0);a[l]|=o<<8*(h+d%4*n),p+=2}return{value:a,binLen:8*p+r}};break;case"B64":e=function(e,t,a){var r,o,i,c,s,u,l,d,h=0;if(-1===e.search(/^[a-zA-Z0-9=+\/]+$/))throw Error("Invalid character in base-64 string");if(o=e.indexOf("="),e=e.replace(/\=/g,""),-1!==o&&o<e.length)throw Error("Invalid '=' found in base-64 string");for(t=t||[0],u=(a=a||0)>>>3,d=-1===n?3:0,o=0;o<e.length;o+=4){for(s=e.substr(o,4),i=c=0;i<s.length;i+=1)c|=(r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(s.charAt(i)))<<18-6*i;for(i=0;i<s.length-1;i+=1){for(r=(l=h+u)>>>2;t.length<=r;)t.push(0);t[r]|=(c>>>16-8*i&255)<<8*(d+l%4*n),h+=1}}return{value:t,binLen:8*h+a}};break;case"BYTES":e=function(e,t,a){var r,o,i,c,s,u;for(t=t||[0],i=(a=a||0)>>>3,u=-1===n?3:0,o=0;o<e.length;o+=1)r=e.charCodeAt(o),c=(s=o+i)>>>2,t.length<=c&&t.push(0),t[c]|=r<<8*(u+s%4*n);return{value:t,binLen:8*e.length+a}};break;case"ARRAYBUFFER":try{e=new ArrayBuffer(0)}catch(e){throw Error("ARRAYBUFFER not supported by this environment")}e=function(e,t,a){return c(new Uint8Array(e),t,a,n)};break;case"UINT8ARRAY":try{e=new Uint8Array(0)}catch(e){throw Error("UINT8ARRAY not supported by this environment")}e=function(e,t,a){return c(e,t,a,n)};break;default:throw Error("format must be HEX, TEXT, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}return e}function g(e,t){return e<<t|e>>>32-t}function b(e,t){return 32<t?(t-=32,new i(e.b<<t|e.a>>>32-t,e.a<<t|e.b>>>32-t)):0!==t?new i(e.a<<t|e.b>>>32-t,e.b<<t|e.a>>>32-t):e}function m(e,t){return e>>>t|e<<32-t}function A(e,t){var n=null;n=new i(e.a,e.b);return 32>=t?new i(n.a>>>t|n.b<<32-t&4294967295,n.b>>>t|n.a<<32-t&4294967295):new i(n.b>>>t-32|n.a<<64-t&4294967295,n.a>>>t-32|n.b<<64-t&4294967295)}function v(e,t){return 32>=t?new i(e.a>>>t,e.b>>>t|e.a<<32-t&4294967295):new i(0,e.a>>>t-32)}function C(e,t,n){return e&t^~e&n}function E(e,t,n){return new i(e.a&t.a^~e.a&n.a,e.b&t.b^~e.b&n.b)}function w(e,t,n){return e&t^e&n^t&n}function O(e,t,n){return new i(e.a&t.a^e.a&n.a^t.a&n.a,e.b&t.b^e.b&n.b^t.b&n.b)}function y(e){return m(e,2)^m(e,13)^m(e,22)}function S(e){var t=A(e,28),n=A(e,34);return e=A(e,39),new i(t.a^n.a^e.a,t.b^n.b^e.b)}function j(e){return m(e,6)^m(e,11)^m(e,25)}function I(e){var t=A(e,14),n=A(e,18);return e=A(e,41),new i(t.a^n.a^e.a,t.b^n.b^e.b)}function B(e){return m(e,7)^m(e,18)^e>>>3}function k(e){var t=A(e,1),n=A(e,8);return e=v(e,7),new i(t.a^n.a^e.a,t.b^n.b^e.b)}function T(e){return m(e,17)^m(e,19)^e>>>10}function Q(e){var t=A(e,19),n=A(e,61);return e=v(e,6),new i(t.a^n.a^e.a,t.b^n.b^e.b)}function R(e,t){var n=(65535&e)+(65535&t);return((e>>>16)+(t>>>16)+(n>>>16)&65535)<<16|65535&n}function N(e,t,n,a){var r=(65535&e)+(65535&t)+(65535&n)+(65535&a);return((e>>>16)+(t>>>16)+(n>>>16)+(a>>>16)+(r>>>16)&65535)<<16|65535&r}function P(e,t,n,a,r){var o=(65535&e)+(65535&t)+(65535&n)+(65535&a)+(65535&r);return((e>>>16)+(t>>>16)+(n>>>16)+(a>>>16)+(r>>>16)+(o>>>16)&65535)<<16|65535&o}function M(e,t){var n,a,r;return n=(65535&e.b)+(65535&t.b),r=(65535&(a=(e.b>>>16)+(t.b>>>16)+(n>>>16)))<<16|65535&n,n=(65535&e.a)+(65535&t.a)+(a>>>16),new i((65535&(a=(e.a>>>16)+(t.a>>>16)+(n>>>16)))<<16|65535&n,r)}function x(e,t,n,a){var r,o,c;return r=(65535&e.b)+(65535&t.b)+(65535&n.b)+(65535&a.b),c=(65535&(o=(e.b>>>16)+(t.b>>>16)+(n.b>>>16)+(a.b>>>16)+(r>>>16)))<<16|65535&r,r=(65535&e.a)+(65535&t.a)+(65535&n.a)+(65535&a.a)+(o>>>16),new i((65535&(o=(e.a>>>16)+(t.a>>>16)+(n.a>>>16)+(a.a>>>16)+(r>>>16)))<<16|65535&r,c)}function D(e,t,n,a,r){var o,c,s;return o=(65535&e.b)+(65535&t.b)+(65535&n.b)+(65535&a.b)+(65535&r.b),s=(65535&(c=(e.b>>>16)+(t.b>>>16)+(n.b>>>16)+(a.b>>>16)+(r.b>>>16)+(o>>>16)))<<16|65535&o,o=(65535&e.a)+(65535&t.a)+(65535&n.a)+(65535&a.a)+(65535&r.a)+(c>>>16),new i((65535&(c=(e.a>>>16)+(t.a>>>16)+(n.a>>>16)+(a.a>>>16)+(r.a>>>16)+(o>>>16)))<<16|65535&o,s)}function U(e,t){return new i(e.a^t.a,e.b^t.b)}function F(e){var t,n=[];if("SHA-1"===e)n=[1732584193,4023233417,2562383102,271733878,3285377520];else if(0===e.lastIndexOf("SHA-",0))switch(n=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],t=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],e){case"SHA-224":break;case"SHA-256":n=t;break;case"SHA-384":n=[new i(3418070365,n[0]),new i(1654270250,n[1]),new i(2438529370,n[2]),new i(355462360,n[3]),new i(1731405415,n[4]),new i(41048885895,n[5]),new i(3675008525,n[6]),new i(1203062813,n[7])];break;case"SHA-512":n=[new i(t[0],4089235720),new i(t[1],2227873595),new i(t[2],4271175723),new i(t[3],1595750129),new i(t[4],2917565137),new i(t[5],725511199),new i(t[6],4215389547),new i(t[7],327033209)];break;default:throw Error("Unknown SHA variant")}else{if(0!==e.lastIndexOf("SHA3-",0)&&0!==e.lastIndexOf("SHAKE",0))throw Error("No SHA variants supported");for(e=0;5>e;e+=1)n[e]=[new i(0,0),new i(0,0),new i(0,0),new i(0,0),new i(0,0)]}return n}function V(e,t){var n,a,r,o,i,c,s,u=[];for(n=t[0],a=t[1],r=t[2],o=t[3],i=t[4],s=0;80>s;s+=1)u[s]=16>s?e[s]:g(u[s-3]^u[s-8]^u[s-14]^u[s-16],1),c=20>s?P(g(n,5),a&r^~a&o,i,1518500249,u[s]):40>s?P(g(n,5),a^r^o,i,1859775393,u[s]):60>s?P(g(n,5),w(a,r,o),i,2400959708,u[s]):P(g(n,5),a^r^o,i,3395469782,u[s]),i=o,o=r,r=g(a,30),a=n,n=c;return t[0]=R(n,t[0]),t[1]=R(a,t[1]),t[2]=R(r,t[2]),t[3]=R(o,t[3]),t[4]=R(i,t[4]),t}function z(e,t,n,a){var r;for(r=15+(t+65>>>9<<4);e.length<=r;)e.push(0);for(e[t>>>5]|=128<<24-t%32,t+=n,e[r]=4294967295&t,e[r-1]=t/4294967296|0,t=e.length,r=0;r<t;r+=16)a=V(e.slice(r,r+16),a);return a}function q(e,t,n){var a,r,o,c,s,u,l,d,h,p,f,g,b,m,A,v,U,F,V,z,q,L,K,Z=[];if("SHA-224"===n||"SHA-256"===n)p=64,g=1,L=Number,b=R,m=N,A=P,v=B,U=T,F=y,V=j,q=w,z=C,K=H;else{if("SHA-384"!==n&&"SHA-512"!==n)throw Error("Unexpected error in SHA-2 implementation");p=80,g=2,L=i,b=M,m=x,A=D,v=k,U=Q,F=S,V=I,q=O,z=E,K=J}for(n=t[0],a=t[1],r=t[2],o=t[3],c=t[4],s=t[5],u=t[6],l=t[7],f=0;f<p;f+=1)16>f?(h=f*g,d=e.length<=h?0:e[h],h=e.length<=h+1?0:e[h+1],Z[f]=new L(d,h)):Z[f]=m(U(Z[f-2]),Z[f-7],v(Z[f-15]),Z[f-16]),d=A(l,V(c),z(c,s,u),K[f],Z[f]),h=b(F(n),q(n,a,r)),l=u,u=s,s=c,c=b(o,d),o=r,r=a,a=n,n=b(d,h);return t[0]=b(n,t[0]),t[1]=b(a,t[1]),t[2]=b(r,t[2]),t[3]=b(o,t[3]),t[4]=b(c,t[4]),t[5]=b(s,t[5]),t[6]=b(u,t[6]),t[7]=b(l,t[7]),t}function L(e,t){var n,a,r,o,c=[],s=[];if(null!==e)for(a=0;a<e.length;a+=2)t[(a>>>1)%5][(a>>>1)/5|0]=U(t[(a>>>1)%5][(a>>>1)/5|0],new i(e[a+1],e[a]));for(n=0;24>n;n+=1){for(o=F("SHA3-"),a=0;5>a;a+=1){r=t[a][0];var u=t[a][1],l=t[a][2],d=t[a][3],h=t[a][4];c[a]=new i(r.a^u.a^l.a^d.a^h.a,r.b^u.b^l.b^d.b^h.b)}for(a=0;5>a;a+=1)s[a]=U(c[(a+4)%5],b(c[(a+1)%5],1));for(a=0;5>a;a+=1)for(r=0;5>r;r+=1)t[a][r]=U(t[a][r],s[a]);for(a=0;5>a;a+=1)for(r=0;5>r;r+=1)o[r][(2*a+3*r)%5]=b(t[a][r],K[a][r]);for(a=0;5>a;a+=1)for(r=0;5>r;r+=1)t[a][r]=U(o[a][r],new i(~o[(a+1)%5][r].a&o[(a+2)%5][r].a,~o[(a+1)%5][r].b&o[(a+2)%5][r].b));t[0][0]=U(t[0][0],Z[n])}return t}var H,J,K,Z;J=[new i((H=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298])[0],3609767458),new i(H[1],602891725),new i(H[2],3964484399),new i(H[3],2173295548),new i(H[4],4081628472),new i(H[5],3053834265),new i(H[6],2937671579),new i(H[7],3664609560),new i(H[8],2734883394),new i(H[9],1164996542),new i(H[10],1323610764),new i(H[11],3590304994),new i(H[12],4068182383),new i(H[13],991336113),new i(H[14],633803317),new i(H[15],3479774868),new i(H[16],2666613458),new i(H[17],944711139),new i(H[18],2341262773),new i(H[19],2007800933),new i(H[20],1495990901),new i(H[21],1856431235),new i(H[22],3175218132),new i(H[23],2198950837),new i(H[24],3999719339),new i(H[25],766784016),new i(H[26],2566594879),new i(H[27],3203337956),new i(H[28],1034457026),new i(H[29],2466948901),new i(H[30],3758326383),new i(H[31],168717936),new i(H[32],1188179964),new i(H[33],1546045734),new i(H[34],1522805485),new i(H[35],2643833823),new i(H[36],2343527390),new i(H[37],1014477480),new i(H[38],1206759142),new i(H[39],344077627),new i(H[40],1290863460),new i(H[41],3158454273),new i(H[42],3505952657),new i(H[43],106217008),new i(H[44],3606008344),new i(H[45],1432725776),new i(H[46],1467031594),new i(H[47],851169720),new i(H[48],3100823752),new i(H[49],1363258195),new i(H[50],3750685593),new i(H[51],3785050280),new i(H[52],3318307427),new i(H[53],3812723403),new i(H[54],2003034995),new i(H[55],3602036899),new i(H[56],1575990012),new i(H[57],1125592928),new i(H[58],2716904306),new i(H[59],442776044),new i(H[60],593698344),new i(H[61],3733110249),new i(H[62],2999351573),new i(H[63],3815920427),new i(3391569614,3928383900),new i(3515267271,566280711),new i(3940187606,3454069534),new i(4118630271,4000239992),new i(116418474,1914138554),new i(174292421,2731055270),new i(289380356,3203993006),new i(460393269,320620315),new i(685471733,587496836),new i(852142971,1086792851),new i(1017036298,365543100),new i(1126000580,2618297676),new i(1288033470,3409855158),new i(1501505948,4234509866),new i(1607167915,987167468),new i(1816402316,1246189591)],Z=[new i(0,1),new i(0,32898),new i(2147483648,32906),new i(2147483648,2147516416),new i(0,32907),new i(0,2147483649),new i(2147483648,2147516545),new i(2147483648,32777),new i(0,138),new i(0,136),new i(0,2147516425),new i(0,2147483658),new i(0,2147516555),new i(2147483648,139),new i(2147483648,32905),new i(2147483648,32771),new i(2147483648,32770),new i(2147483648,128),new i(0,32778),new i(2147483648,2147483658),new i(2147483648,2147516545),new i(2147483648,32896),new i(0,2147483649),new i(2147483648,2147516424)],K=[[0,36,3,41,18],[1,44,10,45,2],[62,6,43,15,61],[28,55,25,21,56],[27,20,39,8,14]],void 0===(a=function(){return o}.call(t,n,t,e))||(e.exports=a)}()},1841:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return jn}));var a=n(24),r=n(12),o=n(13),i=n(14),c=n(15),s=n(6),u=n(0),l=n(1),d=n.n(l),h=n(51),p=n(9),f=n(7),g=n.n(f),b=n(1223);function m(e){return"SignContainerModal"===e?"登录框":"登录页"}var A=n(17),v=n(2),C=n.n(v),E=n(23),w=n(10),O=n(62),y=n(5),S=n(53),j=n(186),I=n(8),B=Object.assign;function k(e){return d.a.createElement(I.a,B(B({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"CheckCircle24","data-old-api":"CheckCircle24"},e),{className:"ZDI ZDI--CheckCircle24"+(e.className?" ".concat(e.className):"")}),d.a.createElement("g",{fillRule:"evenodd",clipRule:"evenodd"},d.a.createElement("path",{d:"M12 20.5a8.5 8.5 0 100-17 8.5 8.5 0 000 17zm0 1.5c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"}),d.a.createElement("path",{d:"M10.414 15.175a.75.75 0 010-1.06L15.16 9.37a.75.75 0 011.06 1.06l-4.744 4.745a.75.75 0 01-1.06 0z"}),d.a.createElement("path",{d:"M7.78 11.48a.75.75 0 011.061 0l2.634 2.634a.75.75 0 01-1.06 1.061L7.78 12.541a.75.75 0 010-1.06z"})))}var T=Object.assign;function Q(e){return d.a.createElement(I.a,T(T({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"ExclamationCircle24","data-old-api":"ExclamationCircle24"},e),{className:"ZDI ZDI--ExclamationCircle24"+(e.className?" ".concat(e.className):"")}),d.a.createElement("path",{d:"M12 20.5a8.5 8.5 0 100-17 8.5 8.5 0 000 17zm0 1.5c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",fillRule:"evenodd",clipRule:"evenodd"}),d.a.createElement("path",{d:"M12 7a.75.75 0 01.75.75v5a.75.75 0 01-1.5 0v-5A.75.75 0 0112 7z",fillRule:"evenodd",clipRule:"evenodd"}),d.a.createElement("path",{d:"M13 16a1 1 0 11-2 0 1 1 0 012 0z"}))}var R=n(398),N=n(489),P=n(52),M=n(77),x=n.n(M),D=function(e){return x()((function(t){var n=Object(p.k)().trackEvent;return Object(u.b)(e,Object.assign({trackEvent:n},t))}),e)},U=n(61),F=Object.assign;var V=function(e){return d.a.createElement(U.a,F({width:"52",height:"52",fill:"none"},e),d.a.createElement("mask",{id:"id-320414155-a",width:"52",height:"52",x:"0",y:"0",maskUnits:"userSpaceOnUse"},d.a.createElement("path",{fill:"#fff",d:"M0 0l52 52V0H0z"})),d.a.createElement("g",{mask:"url(#id-320414155-a)"},d.a.createElement("path",{fill:"#06F",d:"M0 0l52 52V0H0z"}),d.a.createElement("path",{fill:"#fff",d:"M22.125 4h13.75A4.125 4.125 0 0140 8.125v27.75A4.125 4.125 0 0135.875 40h-13.75A4.125 4.125 0 0118 35.875V8.125A4.125 4.125 0 0122.125 4zm6.938 34.222c1.139 0 2.062-.945 2.062-2.11 0-1.167-.923-2.112-2.063-2.112-1.139 0-2.062.945-2.062 2.111 0 1.166.923 2.111 2.063 2.111zM21 8.333v24h16v-24H21z",fillRule:"evenodd",clipRule:"evenodd"}),d.a.createElement("path",{fill:"#fff",d:"M46.996 15.482L39 19.064l-7.996-3.582A1.6 1.6 0 0132.6 14h12.8a1.6 1.6 0 011.596 1.482zM47 16.646V24.4a1.6 1.6 0 01-1.6 1.6H32.6a1.6 1.6 0 01-1.6-1.6v-7.754l8 3.584 8-3.584z",fillRule:"evenodd",clipRule:"evenodd"}),d.a.createElement("path",{fill:"#06F",d:"M31 15.483v1.17l8 3.577 8-3.577v-1.17l-8 3.581-8-3.581z"})))};function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var q=function(e){Object(i.a)(n,e);var t=z(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).cancelCheckQrcodeScanStatus=function(){a.timer&&window.clearInterval(a.timer)},a.checkQrcodeScanStatus=function(e){var t=a.props,n=t.checkQrcodeScanStatus,r=t.trackEvent,o=t.isSignPage;a.timer=setInterval((function(){n({token:e}).then((function(e){var t;null!==(t=e.payload)&&void 0!==t&&t.accessToken&&!o&&(null==r||r({block:"qrcode_loginSuccess"}))}))}),2e3)},a.handleChangeStatus=function(e,t){a.setState({status:e}),"init"!==e||t||a.getToken(),S.b.increment("logIn.qrcode.".concat(e,".count"),.001)},a.handleChangeLoginType=function(){var e=a.props.onChangeType;a.cancelCheckQrcodeScanStatus(),e()},a.initTips=function(){var e=a.props,t=e.isInSignPage,n=e.isBlockType,r=a.state.enableSwitchGuide,o=!t&&!n,i=r?7300:1e3;r&&(a.showSwitchGuideTimeout=setTimeout((function(){a.setState({showSwitchGuide:!0}),a.hideSwitchGuideTimeout=setTimeout((function(){a.setState({showSwitchGuide:!1})}),3e3)}),1e3)),o&&(a.showTipsTimeout=setTimeout((function(){a.setState({showTips:!0}),a.hideTipsTimeout=setTimeout((function(){a.setState({showTips:!1})}),5e3)}),i))},a.state={type:"password",status:"init",errorMessage:"",showTips:!1,showSwitchGuide:!1,enableSwitchGuide:!1,guideTypeSymbol:"d"},a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.isInSignPage,t=this.state.guideTypeSymbol;e&&A.a.trackCardShow(null,{id:9214,name:t}),this.getToken().then(this.initTips)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props,n=t.qrcodeLoginToken,a=t.qrcodeLoginScanStatus,r=e.qrcodeLoginToken,o=e.qrcodeLoginScanStatus,i=e.qrcodeLoginError,c=e.qrcodeLoginReturnNewToken;""!==r&&n!==r?(this.cancelCheckQrcodeScanStatus(),"init"!==this.state.status&&this.handleChangeStatus("init",!0),this.checkQrcodeScanStatus(r)):a!==o?2!==o&&this.handleChangeStatus(1===o?"success":"init",c||1===a&&0===o):i&&i.code&&(this.cancelCheckQrcodeScanStatus(),40321===i.code&&this.setState({status:"error",errorMessage:i.message}))}},{key:"componentWillUnmount",value:function(){this.cancelCheckQrcodeScanStatus(),clearTimeout(this.showTipsTimeout),clearTimeout(this.hideTipsTimeout),clearTimeout(this.showSwitchGuideTimeout),clearTimeout(this.hideSwitchGuideTimeout)}},{key:"getToken",value:function(){return this.props.getQrcodeLoginToken()}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,a=t.qrcodeLoginToken,r=t.isInSignPage,o=t.showSwitchTypeIcon,i=t.isBlockType,c=this.state,s=c.status,l=c.errorMessage,d=c.showTips,h=c.showSwitchGuide,p=c.enableSwitchGuide,f=c.guideTypeSymbol,b=null;return b="init"===s?Object(u.c)("div",{className:"Qrcode-content",children:[Object(u.b)("div",{className:g()("Qrcode-img",{"Qrcode-img--hover":d}),children:a?Object(u.c)(u.a,{children:[Object(u.b)("img",{className:"Qrcode-qrcode",width:"150",height:"150",src:"//".concat(P.a.wwwHost,"/api/v3/account/api/login/qrcode/").concat(a,"/image").concat(r?"?utm_campaign=internal&utm_medium=qr&utm_source=login&utm_term=force_launch&utm_content=qrscan".concat(f):""),alt:"二维码"}),Object(u.b)("img",{alt:"使用手机知乎 APP，打开我的页面，点击左上角扫一扫，可以扫描本页的二维码",className:"Qrcode-tips",src:"https://pica.zhimg.com/v2-88688ab39fa6057a4ea0adc4d8941753.png"})]}):Object(u.b)(j.a,{count:3})}),Object(u.b)("div",{className:"Qrcode-guide-message",children:i&&Object(u.b)("div",{className:"Qrcode-title",children:"扫码登录"})})]}):"success"===s?Object(u.c)(u.a,{children:[Object(u.c)("div",{className:"Qrcode-content Qrcode-success",children:[Object(u.b)("div",{className:"Qrcode-scanResultStaus",children:Object(u.b)(k,{fill:"#2db370",size:58})}),Object(u.b)("p",{className:"Qrcode-scanResultTips",children:"扫描成功"}),Object(u.b)("p",{children:"请在手机上「确认登录」"})]}),Object(u.b)("div",{className:"Qrcode-cutButton",children:Object(u.b)("span",{role:"button",tabIndex:0,onClick:function(){return e.handleChangeStatus("init")},children:"返回二维码"})})]}):Object(u.c)("div",{className:"Qrcode-content Qrcode-failure",children:[Object(u.b)("div",{className:g()({"Qrcode-scanResultStaus":i}),children:Object(u.b)(Q,{fill:"#ffaa00",size:58})}),i&&Object(u.b)("p",{className:"Qrcode-scanResultTips",children:"扫描失败"}),Object(u.b)("p",{children:l})]}),Object(u.c)("div",{className:g()("Qrcode-container",n),children:[p&&Object(u.b)(y.Box,{color:"GBL01A",fontSize:"14px",height:"40px",width:"260px",mt:"-24px",mx:"auto",mb:"15px",css:function(e){return{textAlign:"center",lineHeight:"40px",backgroundColor:e.colorMod(e.colors.GBL01A).alpha(.1),borderRadius:"20px",borderTopRightRadius:"0",transformOrigin:"top right",transform:"scale(".concat(h?"1":"0",")"),opacity:h?"1":"0",transition:"transform 300ms cubic-bezier(0.4, 0, 0.2, 1), opacity 300ms linear"}},children:"点击使用手机号、帐号密码登录"}),Object(u.b)(y.Box,{color:"GBK03A",fontSize:16,fontWeight:"bold",lineHeight:"23px",children:"打开知乎App"}),Object(u.b)(y.Box,{mt:"8px",mb:"24px",color:"GBK03A",fontSize:14,lineHeight:"20px",children:"在「我的页」左上角打开扫一扫"}),b,o&&Object(u.b)(V,{onClick:this.handleChangeLoginType})]})}}]),n}(l.Component);q.propTypes={type:C.a.string,isShowPasswordLogin:C.a.bool,onChangeType:C.a.func,getQrcodeLoginToken:C.a.func,checkQrcodeScanStatus:C.a.func,isInSignPage:C.a.bool,showSwitchTypeIcon:C.a.bool,isBlockType:C.a.bool},q.defaultProps={qrcodeLoginToken:"",qrcodeLoginScanStatus:"",onChangeType:function(){},showSwitchTypeIcon:!0,isBlockType:!1};var L=Object(E.compose)(O.withRouter,D,Object(w.connect)((function(e,t){var n=e.login;return{qrcodeLoginToken:n.qrcodeLoginToken,qrcodeLoginTokenExpires:n.qrcodeLoginTokenExpires,qrcodeLoginScanStatus:n.qrcodeLoginScanStatus,qrcodeLoginError:n.qrcodeLoginError,qrcodeLoginReturnNewToken:n.qrcodeLoginReturnNewToken,edition:Object(R.b)(e),isSignPage:["/signin","/signup"].includes(t.router.location.pathname)}}),{getQrcodeLoginToken:N.c,checkQrcodeScanStatus:N.a}))(q),H=["isQRCodeShown","onQRCodeLinkClick","zaClickId"],J=function(e){return{padding:"4px 10px",border:"1px solid #EBEBEB",borderRadius:"29px",fontSize:"12px",color:e.colors.GBK03A,lineHeight:"19px",":hover":{background:e.colors.GBK10A},display:"inline-block"}},K=function(e){var t=e.isQRCodeShown,n=void 0!==t&&t,r=e.onQRCodeLinkClick,o=e.zaClickId,i=Object(a.default)(e,H);return Object(u.c)(y.Flex,Object.assign(Object.assign({fontSize:14,color:"GBL01A",height:"60px",alignItems:"center",justifyContent:"center",css:{boxSizing:"border-box",margin:"26px 0 22px"}},i),{},{children:[Object(u.b)(y.Box,{children:Object(u.b)(y.Button,{css:J,bg:"unset",fontWeight:"inherit",mr:"8px",onClick:r,children:n?"关闭二维码":"下载知乎App"})}),Object(u.b)(y.Box,{css:{whiteSpace:"nowrap"},children:Object(u.b)(y.Link,{href:"/org/signup",css:J,mr:"8px","data-za-detail-view-id":o,children:"开通机构号"})}),Object(u.b)(y.Box,{css:{whiteSpace:"nowrap"},children:Object(u.b)(y.Button,{css:J,bg:"unset",fontWeight:"inherit",onClick:function(){var e;null===(e=window.aria)||void 0===e||e.start()},"data-za-detail-view-id":o,children:"无障碍模式"})})]}))},Z=n(127),W=n(4),Y=n(18),G=n(1399),_=n(498),X=n(251),$=n(1419),ee=n(1460),te=Object.assign;function ne(e){return d.a.createElement(I.a,te(te({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"EyeAlt24","data-old-api":"EyeAlt24"},e),{className:"ZDI ZDI--EyeAlt24"+(e.className?" ".concat(e.className):"")}),d.a.createElement("path",{d:"M12.001 20.717c5.343 0 8.282-3.087 9.674-5.294a5.88 5.88 0 00.392-5.525C20.919 7.293 18.107 3.283 12 3.283c-6.103 0-8.916 4.005-10.066 6.61l1.372.606-1.372-.606a5.882 5.882 0 00.392 5.534c1.395 2.207 4.334 5.29 9.674 5.29zm-8.406-6.091a4.382 4.382 0 01-.288-4.127c1.025-2.322 3.425-5.716 8.694-5.716 5.272 0 7.67 3.398 8.693 5.72a4.38 4.38 0 01-.288 4.12c-1.224 1.94-3.75 4.594-8.405 4.594-4.653 0-7.18-2.65-8.406-4.591zM9.75 12a2.25 2.25 0 114.5 0 2.25 2.25 0 01-4.5 0zM12 8.25a3.75 3.75 0 100 7.5 3.75 3.75 0 000-7.5z",fillRule:"evenodd",clipRule:"evenodd"}))}var ae=Object.assign;function re(e){return d.a.createElement(I.a,ae(ae({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"EyeSlash24","data-old-api":"EyeSlash24"},e),{className:"ZDI ZDI--EyeSlash24"+(e.className?" ".concat(e.className):"")}),d.a.createElement("path",{d:"M7.517 4.474c1.206-.453 2.608-.724 4.234-.724 6.036 0 8.834 3.715 9.985 6.161a5.255 5.255 0 01-.393 5.219 11.207 11.207 0 01-3.027 3.036.75.75 0 11-.835-1.245c.058-.04.115-.078.171-.118a9.704 9.704 0 002.447-2.511 3.755 3.755 0 00.28-3.742c-1.003-2.131-3.374-5.3-8.628-5.3-1.456 0-2.679.242-3.706.628a.75.75 0 11-.528-1.404zM5.498 6.382a.75.75 0 01-.07 1.059c-1.126.987-1.854 2.148-2.306 3.105a3.756 3.756 0 00.281 3.749c1.206 1.787 3.71 4.26 8.348 4.26 1.237 0 2.315-.175 3.253-.462a.75.75 0 11.438 1.435c-1.084.33-2.31.527-3.69.527-5.28 0-8.198-2.855-9.592-4.921a5.256 5.256 0 01-.394-5.228c.513-1.09 1.353-2.435 2.674-3.593a.75.75 0 011.058.07z",fillRule:"evenodd",clipRule:"evenodd"}),d.a.createElement("path",{d:"M20.048 20.012a.75.75 0 01-1.06.036l-15.5-14.5a.75.75 0 011.025-1.096l15.5 14.5a.75.75 0 01.035 1.06z",fillRule:"evenodd",clipRule:"evenodd"}),d.a.createElement("path",{d:"M9.559 11.535c-.203 1.067.554 2.164 1.808 2.374a2.36 2.36 0 001.707-.36.75.75 0 011.043.191.75.75 0 01-.215 1.04 3.893 3.893 0 01-2.816.602c-1.984-.331-3.381-2.13-3.007-4.094.06-.311.16-.607.297-.881a.768.768 0 011.01-.358.733.733 0 01.338.995 1.908 1.908 0 00-.165.491zm1.219-2.362a.769.769 0 01.716-.797c.302-.02.61-.007.92.045 1.784.299 3.086 1.775 3.066 3.501a.77.77 0 01-.762.754.73.73 0 01-.744-.74c.011-.948-.72-1.854-1.842-2.041a2.427 2.427 0 00-.566-.028.732.732 0 01-.788-.694z",fillRule:"evenodd",clipRule:"evenodd"}))}var oe=n(89),ie=n.n(oe),ce=n(1420),se=["switchDisabled","placeholderPrefix"];function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var le=function(e){Object(i.a)(n,e);var t=ue(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).handleSwitchPasswordInputType=function(){a.setState((function(e){return{inputType:"password"===e.inputType?"text":"password"}}))},a.handleChange=function(e){a.state.hasValue!==Boolean(e)&&a.setState({hasValue:Boolean(e)}),a.props.onChange(e)},a.state={hasValue:Boolean(e.defaultValue),inputType:e.defaultType},a}return Object(o.a)(n,[{key:"render",value:function(){var e=ie()(this.props,["onChange","defaultType"]),t=e.switchDisabled,n=e.placeholderPrefix,r=Object(a.default)(e,se),o=this.state,i=o.inputType,c=o.hasValue;return Object(u.c)("div",{className:"SignFlow-password",children:[Object(u.b)(ce.a,Object.assign({name:"password",inputClassName:"password"===i&&c?"SignFlow-passwordInput":"",type:i,placeholder:"".concat(n||"","密码"),onChange:this.handleChange,errorMessageClassName:"SignFlow-passwordErrorMask",validations:[{type:"required",message:"请输入密码",className:"SignFlow-requiredPasswordErrorMask"}]},r)),!t&&Object(u.b)(Y.c,{className:"SignFlow-switchPassword",tabIndex:-1,preset:"plain",onClick:this.handleSwitchPasswordInputType,icon:"password"===i?ne:re})]})}}]),n}(l.Component);le.propTypes={onChange:C.a.func.isRequired,switchDisabled:C.a.bool,defaultType:C.a.string},le.defaultProps={defaultType:"password"};var de=["onChange","validations"];function he(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var pe=function(e){Object(i.a)(n,e);var t=he(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var e=this.props,t=e.onChange,n=e.validations,r=Object(a.default)(e,de);return Object(u.b)(ce.a,Object.assign({className:"SignFlow-username",onChange:t,validations:n||[{type:"required",message:"请输入用户名"}]},r))}}]),n}(l.Component);pe.propTypes={onChange:C.a.func.isRequired};var fe=pe,ge=n(11),be=n(1304),me=Object.assign;var Ae=function(e){return d.a.createElement(U.a,me({viewBox:"0 0 8 8"},e),d.a.createElement("path",{d:"M7.755 1.434A.839.839 0 007.75.248.837.837 0 006.565.244L4 2.81 1.434.245A.839.839 0 00.248.248c-.33.33-.33.86-.004 1.186L2.81 4 .246 6.566A.839.839 0 00.25 7.752c.33.33.86.33 1.185.004L4 5.19l2.566 2.565a.839.839 0 001.186-.004c.33-.33.33-.86.004-1.185L5.19 4l2.565-2.566z",fillRule:"evenodd"}))},ve=Object.assign;var Ce=function(e){return d.a.createElement(U.a,ve({viewBox:"0 0 20 20"},e),d.a.createElement("circle",{cx:"83",cy:"111",r:"10",transform:"translate(-73 -101)"}))};function Ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var we=function(e){Object(i.a)(n,e);var t=Ee(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={hovered:!0},e.handleMouseEnter=function(){e.setState({hovered:!0})},e.handleMouseLeave=function(){e.setState({hovered:!1})},e}return Object(o.a)(n,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.position!==e.position&&this.handleMouseLeave()}},{key:"shouldComponentUpdate",value:function(e,t){return this.props.position!==e.position||this.state.hovered!==t.hovered}},{key:"render",value:function(){var e=this.props,t=e.position,n=e.onUnMark,a=this.state.hovered,r=a?Ae:Ce;return Object(u.c)(Y.c,{className:"ChineseCaptchaPoint",style:t,onClick:n,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,preset:"plain",children:[Object(u.b)(Ce,{className:g()("ChineseCaptchaPoint-backIcon",{"ChineseCaptchaPoint-backIcon--hovered":a}),fill:a?"#0f88eb":"#aad9ff",width:20,height:20}),Object(u.b)(r,{className:g()("ChineseCaptchaPoint-frontIcon",{"ChineseCaptchaPoint-frontIcon--hovered":a}),fill:a?"#ffffff":"#0f88eb",width:a?8:12,height:a?8:12})]})}}]),n}(l.Component);we.propTypes={onUnMark:C.a.func.isRequired,position:C.a.object.isRequired};var Oe=we;function ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var Se="最多只能选择 ".concat(7," 个点"),je=function(e){Object(i.a)(n,e);var t=ye(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={markPositionsArray:[],isClient:!1},e.updateSize=function(){if(e.chineseCaptchaImg){var t=e.chineseCaptchaImg.getBoundingClientRect();e.chineseImgWidth=t.width,e.chineseImgHeight=t.height}},e.handleMarkPoint=function(t){if(e.chineseCaptchaImg){var n=e.state.markPositionsArray,a=e.props.onValidation;if(n.length>=7)a({validationMessage:Se});else{var r=t.pageX,o=t.pageY;e.updateSize();var i=e.chineseCaptchaImg.getBoundingClientRect(),c=i.top,s=i.left,u=o-c-window.pageYOffset-10,l=r-s-window.pageXOffset-10,d=[].concat(Object(ge.a)(n),[{top:u,left:l+60+16}]);e.updateMarkPoint(d)}}},e.handleUnMarkPoint=function(t){var n=Object(ge.a)(e.state.markPositionsArray);n.splice(t,1),e.updateMarkPoint(n)},e.updateMarkPoint=function(t){e.setState({markPositionsArray:t},(function(){e.props.onUpdateInput(e.parseMarkPositionsArrayToInputValue(t))}))},e.parseMarkPositionsArrayToInputValue=function(t){return JSON.stringify({img_size:[e.chineseImgWidth,e.chineseImgHeight],input_points:t.map((function(e){var t=e.top;return[e.left+10-60-16,t+10]}))})},e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.setState({isClient:!0}),this.updateSize()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.url!==e.url&&this.props.isChinese&&this.setState({markPositionsArray:[]})}},{key:"shouldComponentUpdate",value:function(e,t){return this.props.url!==e.url||this.props.validationMessage!==e.validationMessage||this.props.isShown!==e.isShown||this.props.className!==e.className||this.state.markPositionsArray!==t.markPositionsArray}},{key:"renderCaptcha",value:function(){var e=this,t=this.props,n=t.url,a=t.isChinese,r=t.onRefresh;return n?Object(u.c)("div",{className:a?"Captcha-chineseContainer":"Captcha-englishContainer",children:[Object(u.b)("img",{"data-tooltip":"看不清楚？换一张","aria-label":"看不清楚？换一张",className:a?"Captcha-chineseImg":"Captcha-englishImg",src:n,alt:"图形验证码",onClick:a?this.handleMarkPoint:r,ref:a&&function(t){e.chineseCaptchaImg=t}}),a?this.state.markPositionsArray.map((function(t,n){return Object(u.b)(Oe,{onUnMark:function(){return e.handleUnMarkPoint(n)},position:t},n)})):null]}):null}},{key:"render",value:function(){var e=this.props,t=e.isChinese,n=e.validationMessage,a=e.className,r=e.onUpdateInput,o=e.validations,i=e.isShown,c=e.onRefresh,s=this.state.isClient,l=this.renderCaptcha();return Object(u.b)("div",{className:g()("Captcha",a,{"Captcha-chinese":t&&s}),style:i?{}:{width:"0",height:"0",opacity:"0",overflow:"hidden",margin:"0",padding:"0",border:"0"},children:t?Object(u.c)("div",{children:[Object(u.c)("div",{className:"Captcha-chineseOperator",children:[Object(u.b)("span",{className:g()("Captcha-info",{"Captcha-error":Boolean(n)}),children:n||"请点击图中倒立的文字"}),Object(u.b)(Y.c,{className:"Captcha-chineseRefreshButton",preset:"plain",onClick:c,children:Object(u.b)(be.a,{size:20})})]}),l]}):Object(u.c)("div",{children:[Object(u.b)(ce.a,{name:"captcha",type:"text",errorMessageClassName:"Captcha-errorMessage",placeholder:"验证码",onChange:r,validations:i?o:[],manualValidateError:n,tabIndex:i?0:-1}),Object(u.b)("span",{className:"Captcha-englishImage",children:l})]})})}}]),n}(l.Component);je.propTypes={isChinese:C.a.bool,url:C.a.string,validationMessage:C.a.string,onValidation:C.a.func,onRefresh:C.a.func.isRequired,onUpdateInput:C.a.func.isRequired,isShown:C.a.bool,validations:C.a.array},je.defaultProps={isChinese:!1,isShown:!1,validations:[{type:"required",message:"请填写验证码",className:"Captcha-requiredErrorMessage"}]};var Ie=je;function Be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var ke=function(e){Object(i.a)(n,e);var t=Be(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={validationMessage:""},e.handleValidation=function(t){var n=t.message,a=t.needsRefresh;n&&e.setState({validationMessage:n});var r=e.props,o=r.captchaNeeded,i=r.checkIfCaptchaNeeded,c=r.requestForCaptcha;!o&&a?i(e.lang):a&&c(e.lang)},e.handleRefresh=function(){e.props.requestForCaptcha(e.lang)},e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.type,n=e.isChinese,a=e.checkIfCaptchaNeeded;this.lang=n?"cn":"en",this.type="register"===t?"register":"login",a(this.lang)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props,n=t.validationResult,a=void 0===n?{}:n,r=t.captchaNeeded,o=t.requestForCaptcha,i=e.validationResult,c=void 0===i?{}:i,s=e.captchaNeeded;!r&&s&&o(this.lang),a.timestamp!==c.timestamp&&this.handleValidation(c)}},{key:"componentWillUnmount",value:function(){this.props.resetCaptchaInfo()}},{key:"render",value:function(){var e=this.props,t=e.type,n=e.isChinese,a=e.onUpdateInput,r=e.className,o=e.captchaBase64String,i=e.isShown,c=this.state.validationMessage,s="digitsLogin"!==t?Ie.defaultProps.validations:[];return Object(u.b)(Ie,{className:r,isShown:i,isChinese:n,url:"data:image/jpg;base64,".concat(o),validationMessage:c,onRefresh:this.handleRefresh,onValidation:this.handleValidation,validations:s,onUpdateInput:a})}}]),n}(l.Component);ke.propTypes={canCaptchaShown:C.a.bool,isChinese:C.a.bool,type:C.a.oneOf(["login","digitsLogin","register"]).isRequired,validationResult:C.a.object,captchaNeeded:C.a.bool,captchaBase64String:C.a.string,onUpdateInput:C.a.func,checkIfCaptchaNeeded:C.a.func,requestForCaptcha:C.a.func},ke.defaultProps={canCaptchaShown:!1,isChinese:!1};var Te=Object(w.connect)((function(e,t){var n=e.captcha,a=n.captchaNeeded,r=n.captchaBase64String,o=t.canCaptchaShown;return{isShown:Boolean(o&&a&&r),captchaNeeded:a,captchaBase64String:r}}),{checkIfCaptchaNeeded:X.c,requestForCaptcha:X.f,resetCaptchaInfo:X.h})(ke);function Qe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var Re={phoneNoError:null,fullnameError:null,passwordError:null,digitsError:null},Ne=function(e){Object(i.a)(n,e);var t=Qe(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={email:"",password:"",fullname:"",captcha:"",customErrorInputMap:Object.assign({},Re)},e.handleChange=function(t){return function(n){e.setState(Object(W.a)({},t,n))}},e.runBeforeCheckCaptcha=function(t){var n=e.state.captcha,a=e.props,r=a.captchaNeeded,o=a.checkCaptcha;if(!e.captchaValidated&&r)return n?void o(n).then((function(n){n.payload.success&&(e.captchaValidated=!0,t())})):void e.setState({validationResult:{message:"请输入验证码",needsRefresh:!1,timestamp:Date.now()},smsInputInterceptTime:Date.now()});t()},e.handleSubmit=function(){e.runBeforeCheckCaptcha((function(){var t=e.props,n=t.validateAndRegister;(0,t.resetRegisterValidateResult)();var a=e.state;n({source:"com.zhihu.web",registerType:"email",email:a.email,password:a.password,fullname:a.fullname})}))},e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.props.isLogin&&(location.href="https://www.zhihu.com/logout?next=/email-register")}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props,n=t.captchaValidationMessage,a=t.registerConfirmSucceeded,r=e.captchaValidationMessage,o=e.registerConfirmSucceeded;!a&&o&&(location.href="/"),!n&&r&&this.setState({smsInputInterceptTime:Date.now(),validationResult:{message:r,needsRefresh:Boolean(r),timestamp:Date.now()}})}},{key:"render",value:function(){var e=this.state.validationResult,t=this.props.registerValidateErrors,n=t.email,a=(n=void 0===n?{}:n).message,r=t.fullname,o=(r=void 0===r?{}:r).message,i=t.password,c=(i=void 0===i?{}:i).message;return Object(u.b)(G.a,{children:Object(u.c)($.b,{className:"SignContainer-content EmailRegister",onSubmit:this.handleSubmit,children:[Object(u.b)(fe,{onChange:this.handleChange("fullname"),name:"fullname",placeholder:"用户名",manualValidateError:o}),Object(u.b)(ee.a,{type:"register",placeholder:"输入邮箱",onChange:this.handleChange("email"),manualValidateError:a,supportedCountriesShown:!1}),Object(u.b)(le,{onChange:this.handleChange("password"),manualValidateError:c}),Object(u.b)(Te,{className:"SignFlow-captchaContainer Register-captcha",type:"register",isChinese:this.captchaIsChinese,canCaptchaShown:!0,onUpdateInput:this.handleChange("captcha"),validationResult:e}),Object(u.b)(Y.c,{className:"EmailRegister-submitButton",preset:"primary",color:"blue",type:"submit",children:"注册"})]})})}}]),n}(l.Component),Pe=(Object(E.compose)(Z.a,Object(w.connect)((function(e){var t=e.captcha,n=t.captchaNeeded,a=t.captchaValidationMessage,r=e.register;return{captchaNeeded:n,registerValidateErrors:r.registerValidateErrors,captchaValidationMessage:a,registerConfirmSucceeded:r.registerConfirmSucceeded}}),{checkCaptcha:X.b,validateAndRegister:_.d,resetRegisterValidateResult:_.c}))(Ne),n(161)),Me=n.n(Pe),xe=n(148),De=Object.assign;function Ue(e){return d.a.createElement(I.a,De(De({width:"16",height:"16",viewBox:"0 0 16 16","data-new-api":"ArrowLeft16","data-old-api":"ArrowLeft16"},e),{className:"ZDI ZDI--ArrowLeft16"+(e.className?" ".concat(e.className):"")}),d.a.createElement("path",{d:"M11.46 1.54a.65.65 0 010 .92L5.92 8l5.54 5.54a.65.65 0 11-.92.92L4.73 8.648a.917.917 0 010-1.296l5.81-5.812a.65.65 0 01.92 0z",fillRule:"evenodd",clipRule:"evenodd"}))}var Fe,Ve=n(26),ze=n(37),qe=n(103),Le=n(1559),He=n(1496),Je=["countDownEvent","countDownEndEvent","startAtOnce","interceptTime","isEmail","reStartTime","smsType"];function Ke(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var Ze=function(e){Object(i.a)(n,e);var t=Ke(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var e,t=this.props,n=t.countDownEvent,r=t.countDownEndEvent,o=t.startAtOnce,i=t.interceptTime,c=t.isEmail,s=t.reStartTime,l=t.smsType,d=Object(a.default)(t,Je);return e=c?"邮箱":"voice"===l?"语音":"短信",Object(u.c)("div",{className:"SignFlow SignFlow-smsInputContainer",children:[Object(u.b)(ce.a,Object.assign({name:"digits",className:"SignFlow-smsInput",type:"number",smsType:l,errorMessageClassName:"SignFlow-smsInputErrorMessage",placeholder:"输入 6 位".concat(e,"验证码"),validations:[{type:"required",message:"请输入".concat(e,"验证码"),className:"SignFlow-smsInputRequiredErrorMask"}]},d)),Object(u.b)(Le.a,{className:"SignFlow-smsInputButton",preset:"plain",initialText:"获取".concat(e,"验证码"),resetText:"重新获取".concat(e,"验证码"),countingText:Object(He.a)(Fe||(Fe=Object(qe.a)([""," 秒后可重发"])),"count"),startAtOnce:o,event:n,countDownEndEvent:r,interceptTime:i,reStartTime:s})]})}}]),n}(l.Component);Ze.propTypes={countDownEvent:C.a.func.isRequired,startAtOnce:C.a.bool,interceptTime:C.a.number,reStartTime:C.a.number,isEmail:C.a.bool,countDownEndEvent:C.a.func,smsType:C.a.string},Ze.defaultProps={startAtOnce:!1,isEmail:!1};var We=Ze,Ye=n(1571),Ge=n.n(Ye),_e=(n(31),"c3cef7c66a1843f8b3a9e6a1e3160e20");"".concat("z_").concat("c0"),"".concat("SZYUpkoc0tvY").concat("Xh0V2E2UTB").concat("UID096dwe");var Xe=function(e,t){var n=Date.now(),a=new Ge.a("SHA-1","TEXT");return a.setHMACKey("d1b964811afb40118a12068ff74a12f4","TEXT"),a.update(e),a.update(_e),a.update("com.zhihu.web"),a.update(String(n)),Object.assign({clientId:_e,grantType:e,timestamp:n,source:"com.zhihu.web",signature:a.getHMAC("HEX")},t)};function $e(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var et={phoneNoError:null,fullnameError:null,digitsError:null},tt=function(e){Object(i.a)(n,e);var t=$e(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={fullname:e.props.defaultFullname||"",avatarPath:"",phoneNo:"",digits:"",captcha:"",isRegister:null,smsBackUpDisplay:!0,smsType:"text",selectedCountry:{name:"中国",code:"+86"},smsInputInterceptTime:-1,reStartTime:-1,customErrorInputMap:Object.assign({},et),validationResult:{}},e.captchaIsChinese=Math.random()<.5,e.getSocialInfo=function(t){var n=t||e.props,a=n.getSocialInfo,r=n.socialType;r&&a(r).then((function(t){var n=t.payload,a=n.name,r=n.profileImageUrl;e.setState({avatarPath:r.split("/").reverse()[0],fullname:a})}))},e.testPhoneNo=function(){var t=e.state,n=t.selectedCountry.code,a=t.phoneNo;return"+86"!==n||/^\d{11}$/.test(a)},e.handleChange=function(t){return function(n){e.setState(Object(W.a)({},t,n))}},e.handleBackUpDigits=function(){e.setState({smsType:"text"===e.state.smsType?"voice":"text",reStartTime:Date.now()})},e.handleCountDownEndEvent=function(){e.setState({smsBackUpDisplay:!0})},e.parseServerError=function(t){var n=t||e.props,a=n.showNotification,r=n.registerValidateErrors,o=n.loginConfirmError,i=n.registerConfirmError,c=n.sendDigitsError,s=o||{},u=s.username,l=s.password,d=s.digits,h=s.captcha,p=i||{},f=p.username,g=p.password,b=p.digits,m=p.undefined;m&&a(m,"red");var A=c||{},v=A.username,C=A.captcha,E=(r||{}).fullname;return{usernameServerError:u||v,passwordServerError:l||g,digitsServerError:d||b,captchaServerError:h||C,fullnameServerError:(E=void 0===E?{}:E).message||f}},e.runBeforeCheckCaptcha=function(t){var n=e.state.captcha,a=e.props,r=a.captchaNeeded,o=a.checkCaptcha;if(!e.captchaValidated&&r)return n?void o(n,e.captchaIsChinese?"cn":"en").then((function(n){n.payload.success&&(e.captchaValidated=!0,t())})):void e.setState({validationResult:{message:e.captchaIsChinese?"请点击图中倒立的文字":"请输入验证码",needsRefresh:!1,timestamp:Date.now()},smsInputInterceptTime:Date.now()});t()},e.runBeforeResetValidateResult=function(t){e.setState({customErrorInputMap:Object.assign({},et),validationResult:{needsRefresh:!1,timestamp:Date.now()}},(function(){t()}))},e.handleSendDigits=function(){var t=e.state.phoneNo;t&&e.testPhoneNo()?e.runBeforeCheckCaptcha((function(){e.runBeforeCheckCaptcha(e.sendDigits)})):e.setState({customErrorInputMap:Object.assign(Object.assign({},e.state.customErrorInputMap),{},{phoneNoError:t?"请输入正确的手机号":"请输入手机号"}),smsInputInterceptTime:Date.now()})},e.sendDigits=function(){var t=e.state,n=t.selectedCountry,a=t.phoneNo,r=t.smsType,o=e.props.sendLoginDigits;e.props.validateRegisterForm({phoneNo:"".concat(n.code).concat(a)}).then((function(t){var i=t.payload;e.setState({smsBackUpDisplay:!1,isRegister:!(i.phoneNo&&i.phoneNo.code===Ve.o)}),o("".concat(n.code).concat(a),r)}))},e.handleSubmit=function(){e.runBeforeCheckCaptcha((function(){e.runBeforeResetValidateResult((function(){var t=e.state,n=t.selectedCountry,a=t.phoneNo,r=t.digits,o=t.isRegister,i=t.fullname,c=t.avatarPath,s=e.props,u=s.validateAndLogin,l=s.validateAndRegister,d=s.nextUrl,h=s.socialType,p=Object(xe.c)(d),f=p.utm_source,g=p.utm_medium;o?l(Object.assign(Object.assign({source:"com.zhihu.web",registerType:"phone_digits",phoneNo:"".concat(n.code).concat(a),fullname:i,digits:r,refSource:g,utmSource:f},c&&{avatarPath:c}),h&&{socialRegisterType:h})):u(Xe("digits",{username:"".concat(n.code).concat(a),digits:r,refSource:g,utmSource:f}))}))}))},e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){if(Me.a.get("atoken")){this.getSocialInfo();var e=Me.a.get("accountcallback");if(!this.state.fullname&&e){var t=JSON.parse(decodeURIComponent(e));this.setState({fullname:t.fullname})}}else this.props.onResetRegister()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props,n=t.nextUrl,a=t.socialType,r=t.defaultFullname,o=t.sendDigitsError,i=t.loginConfirmError,c=t.loginConfirmSucceeded,s=t.registerConfirmSucceeded,u=t.captchaValidationMessage,l=e.socialType,d=e.defaultFullname,h=e.sendDigitsError,p=e.loginConfirmError,f=e.loginConfirmSucceeded,g=e.registerConfirmSucceeded,b=e.captchaValidationMessage;if(!a&&l&&this.getSocialInfo(e),r!==d&&this.setState({fullname:d}),!c&&f||!s&&g)n?location.href=n:location.reload();else{if(!i&&p&&p.validateDigitsError&&this.setState({customErrorInputMap:Object.assign(Object.assign({},this.state.customErrorInputMap),{},{digitsError:p.validateDigitsError}),smsInputInterceptTime:Date.now()}),!o&&h){var m=this.parseServerError(e).captchaServerError;this.setState({validationResult:{message:m,needsRefresh:!0,timestamp:Date.now()},smsInputInterceptTime:Date.now()})}!u&&b&&this.setState({smsInputInterceptTime:Date.now(),validationResult:{message:b,needsRefresh:Boolean(b),timestamp:Date.now()}})}}},{key:"render",value:function(){var e=this.state,t=e.smsInputInterceptTime,n=e.customErrorInputMap,a=e.smsBackUpDisplay,r=e.validationResult,o=e.reStartTime,i=e.isRegister,c=e.phoneNo,s=e.smsType,l=e.fullname,d=this.props.onResetRegister,h=n.phoneNoError,p=n.digitsError,f=this.parseServerError(),b=f.usernameServerError,m=f.fullnameServerError,A=f.digitsServerError,v=Object(u.c)($.b,{className:"Register-content",onSubmit:this.handleSubmit,children:[Object(u.b)("div",{className:"Register-socialHeader",children:Object(u.c)("div",{className:"Register-socialTitle",children:[Object(u.b)(Y.c,{onClick:d,children:Object(u.b)(Ue,{})}),"绑定手机"]})},"header"),Object(u.b)(fe,{className:g()("Register-socialName",{"Register-hiddenSocialName":!i}),name:"fullname",placeholder:"用户名",value:l,onChange:this.handleChange("fullname"),manualValidateError:m,validations:[],targetClassName:"username-input"},"fullname"),Object(u.b)(ee.a,{type:"register",onChange:this.handleChange("phoneNo"),onSelect:this.handleChange("selectedCountry"),manualValidateError:h||b,targetClassName:"username-input"}),Object(u.b)(Te,{className:"SignFlow-captchaContainer",type:"register",isChinese:this.captchaIsChinese,canCaptchaShown:Boolean(c),onUpdateInput:this.handleChange("captcha"),validationResult:r}),Object(u.b)(We,{smsType:s,reStartTime:o,onChange:this.handleChange("digits"),countDownEvent:this.handleSendDigits,countDownEndEvent:this.handleCountDownEndEvent,interceptTime:t,manualValidateError:p||A,targetClassName:"username-input"}),Object(u.b)("div",{className:g()("Register-smsBackUp",{"Register-hiddenSmsBackUp":!a}),children:Object(u.c)("span",{role:"button",tabIndex:0,onClick:this.handleBackUpDigits,children:["获取","text"===s?"语音":"短信","验证码"]})}),Object(u.b)(Y.c,{className:"Register-submitButton",type:"submit",preset:"primary",color:"blue",children:"进入知乎"})]});return Object(u.b)(G.a,{children:v})}}]),n}(l.Component),nt=Object(w.connect)((function(e){var t=e.captcha,n=t.captchaNeeded,a=t.captchaValidationMessage,r=e.register,o=r.registerConfirmError,i=r.registerValidateErrors,c=r.registerConfirmSucceeded,s=e.login,u=s.loginConfirmSucceeded,l=s.validateDigitsError,d=s.loginConfirmError;return{captchaNeeded:n,sendDigitsError:s.sendDigitsError,registerConfirmError:o,registerValidateErrors:i,captchaValidationMessage:a,registerConfirmSucceeded:c,loginConfirmSucceeded:u,validateDigitsError:l,loginConfirmError:d}}),{showNotification:ze.g,checkCaptcha:X.b,validateDigits:N.i,sendLoginDigits:N.g,validateAndLogin:N.h,validateAndRegister:_.d,getSocialInfo:_.b,validateRegisterForm:_.e,resetLoginValidateResult:N.f,resetRegisterValidateResult:_.c})(tt),at=n(16),rt=n(121),ot=n(1338),it=function(e){var t=e.onBack,n=e.data,a=n.phoneNo,r=n.code,o=n.targetNo,i=e.onSubmit;return Object(u.c)("div",{className:"SMSIdentify",children:[Object(u.c)("div",{className:"SMSIdentify-back",role:"button",tabIndex:0,onClick:t,children:[Object(u.b)(ot.a,{fill:"#8590a6",size:36,center:!0}),"返回"]}),Object(u.b)("div",{className:"SMSIdentify-title",children:"身份验证"}),Object(u.c)("div",{className:"SMSIdentify-tip",children:["请用手机号 ",a.slice(0,-8),"****",a.slice(-4)," 发送短信"]}),Object(u.c)("div",{className:"SMSIdentify-content",children:[Object(u.c)("div",{children:["短信内容",Object(u.b)("span",{children:r})]}),Object(u.c)("div",{children:["发送到号码",Object(u.b)("span",{children:o})]})]}),Object(u.b)("div",{className:"SMSIdentify-submitTip",children:"发送完成后，请点击下方按钮进行校验"}),Object(u.b)(Y.c,{className:"SMSIdentify-submit",preset:"primary",color:"blue",onClick:i,children:"我已发送"})]})},ct=Object(w.connect)(null,{getSMSIdentify:N.d,postSMSIdentify:N.e,showNotification:ze.g})((function(e){var t=e.getSMSIdentify,n=e.postSMSIdentify,a=e.showNotification,r=e.onBack,o=e.phoneNo,i=Object(l.useState)({code:"",phoneNo:"",targetNo:""}),c=Object(at.a)(i,2),s=c[0],d=c[1];Object(l.useEffect)((function(){A.a.trackCardShow(null,{id:5935})}),[]),Object(l.useEffect)((function(){o&&t(o).then((function(e){var t=e.payload;t&&d(t)})).catch((function(e){var t=e.payload;t&&d(t)}))}),[t,o]);var h=it;return Object(u.b)(h,{onBack:r,onSubmit:function(){A.a.trackEvent(null,{id:23456}),n(o).then((function(e){var t=e.payload;A.a.trackEvent(null,{id:6729,action:"Click",name:t.success?"通过":"失败"}),t.success?r():a("没有收到短信，请稍后重试","red")}))},data:s})})),st=function(e){var t=e.captcha,n=t.captchaValidationMessage,a=t.captchaNeeded,r=t.captchaValidated,o=t.v2,i=e.login,c=i.loginConfirmSucceeded,s=i.loginConfirmError,u=i.sendDigitsError,l=i.needSMSIdentify,d=i.loginUnregisteredError,h=i.verification,p=e.register;return{loginConfirmSucceeded:c,loginConfirmError:s,sendDigitsError:u,loginUnregisteredError:d,captchaValidationMessage:n,captchaNeeded:a,captchaValidated:r,registerValidateErrors:p.registerValidateErrors,registerConfirmError:p.registerConfirmError,registerConfirmSucceeded:p.registerConfirmSucceeded,needSMSIdentify:l,captchaV2:o,verification:h}},ut=n(1432),lt=Object.assign;var dt=function(e){return d.a.createElement(U.a,lt({width:"52",height:"52",fill:"none",xmlnsXlink:"http://www.w3.org/1999/xlink"},e),d.a.createElement("mask",{id:"id-3757926926-a",width:"52",height:"52",x:"0",y:"0",maskUnits:"userSpaceOnUse"},d.a.createElement("path",{fill:"#fff",d:"M0 0l52 52V0H0z"})),d.a.createElement("g",{mask:"url(#id-3757926926-a)"},d.a.createElement("path",{fill:"#06F",d:"M0 0h48a4 4 0 014 4v48L0 0z"}),d.a.createElement("path",{fill:"url(#pattern0)",d:"M0 0h52v52H0z"})),d.a.createElement("defs",null,d.a.createElement("pattern",{id:"pattern0",width:"1",height:"1",patternContentUnits:"objectBoundingBox"},d.a.createElement("use",{transform:"scale(.00216)",xlinkHref:"#image0"})),d.a.createElement("image",{id:"image0",width:"463",height:"463",xlinkHref:"data:image/png;base64,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"})))},ht=function(e){var t=e.type,n=e.showSwitchTypeIcon,a=Object(G.b)().handleChangeType;return Object(u.c)("div",{className:"SignFlow-tabs",children:[Object(u.b)(p.a,{as:"div",zaText:"免密码登录",zaType:"Button",zaAction:"Save",className:g()("SignFlow-tab",{"SignFlow-tab--active":"digits"===t}),role:"button",tabIndex:0,onClick:function(){"digits"!==t&&a("digits")},onKeyDown:function(e){Object(ut.b)(e)&&"digits"!==t&&a("digits")},children:"验证码登录"}),Object(u.b)(p.a,{as:"div",zaText:"密码登录",zaType:"Button",zaAction:"Save",className:g()("SignFlow-tab",{"SignFlow-tab--active":"password"===t}),role:"button",tabIndex:0,onClick:function(){"password"!==t&&a("password")},onKeyDown:function(e){Object(ut.b)(e)&&"password"!==t&&a("password")},children:"密码登录"}),n&&Object(u.b)(p.a,{as:"div",zaText:"二维码图片登录",zaType:"Button",zaAction:"Save",role:"button",tabIndex:0,"aria-label":"二维码图片",className:"SignFlow-qrcodeTab",onClick:function(){a("qrcode")},children:Object(u.b)(dt,{})})]})};ht.propTypes={showSwitchTypeIcon:C.a.bool},ht.defaultProps={showSwitchTypeIcon:!0};var pt=ht,ft=["type","isOversea","supportedCountriesShown","selectedCountry","username","usernameServerError","customErrorInputMap"],gt=function(e){var t=e.type,n=e.isOversea,r=e.supportedCountriesShown,o=e.selectedCountry,i=e.username,c=e.usernameServerError,s=e.customErrorInputMap,l=(s=void 0===s?{}:s).username,d=Object(a.default)(e,ft),h=Object(G.b)().handleChange;return Object(u.b)(ee.a,Object.assign({type:"digits"===t||r?"digits":"password",supportedCountriesShown:"digits"===t||n,onChange:function(e){return h("username",e)},onSelect:function(e){return h("selectedCountry",e)},defaultSelectedCountry:o,manualValidateError:c||l,defaultValue:i},d))},bt=function(e){var t=e.handleRegister,n=e.setState,a=e.usernameServerError,r=e.passwordServerError,o=e.submitDisabled,i=Object(w.useDispatch)(),c=Object(rt.a)((function(e){return function(t){return n(Object(W.a)({},e,t))}}));return Object(u.c)($.b,{className:"SignFlow-setting",onSubmit:t,children:[Object(u.c)("div",{role:"button",tabIndex:0,className:"SignFlow-back",onClick:function(){return i(N.f.apply(void 0,arguments))},children:[Object(u.b)(ot.a,{center:!0,size:28,fill:"#8590a6"}),"返回"]}),Object(u.b)("div",{className:"SignFlow-settingTitle",children:"设置用户名和密码"}),Object(u.b)(fe,{name:"fullname",placeholder:"用户名",onChange:c("fullname"),manualValidateError:a}),Object(u.b)(le,{onChange:c("password"),placeholderPrefix:"8 位数字或字母",defaultType:"text",manualValidateError:r}),Object(u.b)(Y.c,{type:"submit",className:"SignFlow-submitButton",preset:"primary",color:"blue",disabled:o,children:"进入知乎"})]},"setting")},mt=["type","smsInputInterceptTime","digitsServerError","smsType","reStartTime","passwordServerError","password"],At=function(e){var t=e.type,n=e.smsInputInterceptTime,r=e.digitsServerError,o=e.smsType,i=e.reStartTime,c=e.passwordServerError,s=e.password,l=Object(a.default)(e,mt),d=Object(G.b)(),h=d.handleSendDigits,p=d.setState,f=Object(rt.a)((function(){p({smsBackUpDisplay:!0})})),g=Object(rt.a)((function(e){return p({digits:e})})),b=Object(rt.a)((function(e){return p({password:e})}));return Object(u.c)(u.a,{children:["digits"===t&&Object(u.b)(u.a,{children:Object(u.b)(We,Object.assign({countDownEvent:h,countDownEndEvent:f,interceptTime:n,manualValidateError:r,smsType:o,reStartTime:i,onChange:g},l))}),"password"===t&&Object(u.b)(u.a,{children:Object(u.b)(le,Object.assign({onChange:b,manualValidateError:c,defaultValue:s},l))})]})},vt=function(e){var t=e.smsBackUpName,n=e.smsBackUpDisplay,a=e.isOverSea,r=e.smsType,o=e.type,i=e.containerType,c=Object(G.b)(),s=c.handleChangeType,l=c.setState,d=Object(rt.a)((function(){A.a.trackEvent(event.currentTarget,{id:4947}),A.a.trackEvent(void 0,{action:"Click",element:"Button",element_name:"ResetPassword"}),window.open("".concat(Ve.x,"/account/password_reset"),"_blank")})),h=Object(rt.a)((function(e){A.a.trackEvent(e.currentTarget,{id:4941}),l({smsType:"text"===r?"voice":"text",smsBackUpName:"text"===r?"短信":"语音",reStartTime:Date.now()})})),f={configMap:{containerType:m(i)}};return Object(u.c)("div",{className:"Login-options",children:[Object(u.b)(p.a,{as:Y.c,zaText:a?"邮箱帐号登录":"海外手机号登录",zaType:"Button",zaAction:"Expand",extra:f,preset:"plain",className:"Login-switchType",onClick:function(){"digits"!==o&&s(a?"email":"oversea")},children:"digits"!==o&&(a?"邮箱帐号登录":"海外手机号登录")}),Object(u.b)(Y.c,{preset:"plain",className:"Login-cannotLogin",onClick:"digits"===o?h:d,children:"digits"===o?n&&Object(u.c)(p.f,{zaType:"Text",zaText:"免密码登录",extra:f,children:["获取",t,"验证码"]},"noPassword"):Object(u.b)(p.f,{zaType:"Text",zaText:"密码登录",extra:f,children:"忘记密码"},"forgetPassword")})]})},Ct=function(e){var t=e.submitDisabled,n=e.type,a=e.containerType;return Object(u.b)(p.a,{as:Y.c,zaText:"登录",zaType:"Button",zaAction:"Signin",extra:{configMap:{containerType:m(a),signinType:n}},type:"submit",className:"SignFlow-submitButton",preset:"primary",color:"blue",disabled:t,children:P.a.allowSignUp?"登录/注册":"登录"})},Et=n(499),wt=n.n(Et),Ot=function(e,t,n){var a=Object(rt.a)(t);Object(l.useEffect)((function(){return wt.a.bind(e,a,n),function(){wt.a.unbind(e)}}),[JSON.stringify(e),a,n])},yt=n(1398),St=n(71),jt=n.n(St),It=n(176),Bt=n(709);function kt(e,t){var n,a=e.onReady,r=e.onVerify,o=e.onClose,i=Object(w.useSelector)((function(e){return e.captcha})).v2,c=Object(l.useRef)(null),s=Object(Bt.a)(),d=null==i||null===(n=i.script)||void 0===n?void 0:n[1],h=Object(l.useRef)(null),p=Object(l.useRef)(),f=Object(l.useRef)(),g=Object(l.useState)("init"),b=Object(at.a)(g,2),m=b[0],A=b[1];Object(l.useEffect)((function(){if(null!=i&&i.script){var e=d?jt.a.parse(null==d?void 0:d.split("?")[1]).captchaId:"0";return h.current&&h.current!==e?(s.confirm("页面将自动刷新，请在刷新后重试",{title:"验证码已过期",ok:"刷新"}).then((function(){location.reload()})).catch((function(){c.current&&clearTimeout(c.current)})),c.current=setTimeout((function(){location.reload()}),5e3)):h.current=e,function(){c.current&&clearTimeout(c.current)}}}),[i,d,s]),Object(l.useImperativeHandle)(t,(function(){return{get required(){return Boolean(i)},get ready(){return Boolean(f.current)},get type(){var e;return(null===(e=f.current)||void 0===e?void 0:e.type)||"vendor"},show:function(){var e;null===(e=f.current)||void 0===e||e.show()},close:function(){var e;return null===(e=f.current)||void 0===e?void 0:e.close()},refresh:function(){var e;return null===(e=f.current)||void 0===e?void 0:e.refresh()}}}));var v=Object(rt.a)((function(e){var t;if(null!==(t=e.script)&&void 0!==t&&t.length){A("loading");var n,i,c=e.script.map((function(e){return function(){return Object(It.loadScript)(e)}}));(n=c,i=[],n.reduce((function(e,t){return e.then((function(){return t().then((function(e){i.push(e)}))}))}),Promise.resolve()).then((function(){return i}))).then((function(){return A("mount"),window.ZS_CAP.init({element:p.current,callback:function(e){null==r||r(e)},enableClose:!0,onClose:o})})).then((function(e){f.current=e,A("ready"),null==a||a()})).catch((function(e){var t;return null===(t=window.Raven)||void 0===t?void 0:t.captureException(e)}))}else A("bypass")}));return Object(l.useEffect)((function(){i&&"init"===m&&v(i)}),[i,m,v]),i?Object(u.b)("div",{ref:p}):null}var Tt=d.a.memo(d.a.forwardRef(kt)),Qt=function(e){var t=e.type,n=e.captchaV2,a=Object(w.useDispatch)();return Object(rt.a)((function(){"qrcode"!==t&&(n&&a(Object(X.h)()),a(Object(X.d)("captcha_sign_in")))}))},Rt=function(e){var t=e.type,n=e.captchaV2Ref,a=e.onVerify,r=e.lastSubmittedTimestamp,o=Object(w.useDispatch)(),i=Object(G.b)(),c=i.continueActionRef,s=i.captchaV2,d=Qt({type:t,captchaV2:s});Object(l.useEffect)((function(){d(),S.b.increment("logIn.captcha.request.count",.001)}),[d]),Ot(["esc"],(function(){var e;null===(e=n.current)||void 0===e||e.close()}));return Object(l.useEffect)((function(){var e;r&&(-1!==r&&(console.log("captcha refresh!"),null===(e=n.current)||void 0===e||e.refresh()))}),[r,n]),Object(u.b)(Tt,{ref:n,onVerify:function(e){if(e instanceof Error)return S.b.increment("logIn.captcha.wrong.count"),o(Object(ze.g)(e.message||"验证失败","red"));if(null==e||!e.type||null==e||!e.result)return o(Object(ze.g)("错误的验证方式","red"));var t=e.result;o(Object(X.g)(JSON.stringify(t),!0,"captcha_sign_in")).then((function(e){var t,n=e.payload;null!=n&&n.success&&(null==a||a({result:"success"}),null!=c&&c.current&&(null===(t=c.current)||void 0===t||t.call(c)))})).catch((function(e){var t;if(null==a||a({result:"fail"}),"ResponseError"!==(null==e?void 0:e.name)||120001!==(null===(t=e.payload)||void 0===t?void 0:t.code))throw o(Object(ze.g)(Object(yt.b)(e),"red")),e;o(Object(ze.g)("页面已过期，请刷新页面重试","red"))})).finally((function(){var e;c&&(c.current=null),null===(e=n.current)||void 0===e||e.close()}))},onClose:function(){var e;r||(console.log("captcha refresh!"),null===(e=n.current)||void 0===e||e.refresh())}})},Nt=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Pt=function(e){return Nt.test(e)},Mt=function(e){var t=e.props,n=e.setState,a=e.state,r=t.onChangeType,o=t.type,i=t.captchaV2,c=Object(w.useDispatch)(),s=a.username,u=Qt({props:t});return Object(rt.a)((function(e){c(Object(N.f)()),r(e),"qrcode"!==e&&"password"!==e||A.a.trackEvent(null,{action:"Click",name:"qrcode"===e?"使用二维码登录":"使用密码登录"},{account:{type:"Zhihu"}}),"qrcode"!==e&&(n({username:"password"===o&&Pt(s)?"":s,smsBackUpDisplay:!0}),i||u())}))},xt=function(e){var t,n=e.loginConfirmError,a=e.sendDigitsError,r=e.registerValidateErrors,o=(t=n,Object(l.useMemo)((function(){var e=t||{};return{loginUsernameServerError:e.username,passwordServerError:e.password,digitsServerError:e.digits,captchaServerError:e.captcha,undefinedLoginError:e.undefined,validateDigitsError:e.validateDigitsError}}),[t])),i=o.loginUsernameServerError,c=o.passwordServerError,s=o.digitsServerError,u=o.captchaServerError,d=o.undefinedLoginError,h=o.validateDigitsError,p=function(e){return Object(l.useMemo)((function(){var t=e||{};return{sendDigitsUsernameServerError:t.username,undefinedDigitsError:t.undefined}}),[e])}(a),f=p.sendDigitsUsernameServerError,g=p.undefinedDigitsError,b=function(e){return Object(l.useMemo)((function(){var t=e||{},n=t.fullname,a=(n=void 0===n?{}:n).message,r=t.password;return{fullnameError:a,registerPasswordServerError:(r=void 0===r?{}:r).message}}),[e])}(r),m=b.fullnameError,A=b.registerPasswordServerError;return{usernameServerError:f||i,passwordServerError:c||A,digitsServerError:s||h,captchaServerError:u,fullnameError:m,undefinedLoginError:d,undefinedDigitsError:g}},Dt=function(e){var t=e.setState,n=Object(w.useDispatch)();return Object(rt.a)((function(e,a){n(Object(N.f)()),t(Object(W.a)({},e,a))}))},Ut=function(e){var t=e.state,n=t.selectedCountry.code,a=t.username;return Object(rt.a)((function(){return"+86"!==n||/^\d{11}$/.test(a)}))};function Ft(e,t){if(!e)return{};var n,a=e=e.trim(),r=Pt(e);if(!r){var o={hasCode:(n=e).startsWith("+")||n.startsWith("00"),parsedPhoneNo:n.startsWith("00")?"+".concat(n.slice(2)):n};a=o.hasCode?o.parsedPhoneNo:"".concat(t).concat(e)}return{value:a,isEmail:r}}var Vt=function(e){var t=e.props,n=e.setState,a=e.runBeforeResetValidateResult,r=e.runBeforeCheckCaptcha,o=e.testPhoneNo,i=e.continueActionRef,c=e.selectedCountry,s=e.captcha,u=e.customErrorInputMap,l=e.username,d=e.trackLoginSuccess,h=t.type,p=t.isOverSea,f=t.nextUrl,g=Object(w.useDispatch)();return Object(rt.a)((function(e){A.a.trackEvent(void 0,{id:4948}),a((function(){if("digits"!==h&&!p||o()){S.b.increment("logIn.clickLogInBtn.count",.1);var t=function(){var t=Object(xe.c)(f),a=t.utm_source,r=t.utm_medium,o=Object.assign(Object.assign({},e),{},{username:Ft(e.username,c.code).value,captcha:s,utmSource:a,refSource:r});n({lastSubmittedTimestamp:Date.now()}),g(Object(N.h)(Xe(h,o))).then((function(e){var t;null!==(t=e.payload)&&void 0!==t&&t.accessToken&&(null==d||d())}))};i.current=t,r().then((function(e){e&&t()})).finally((function(){return n({submitDisabled:!1})}))}else n({customErrorInputMap:Object.assign(Object.assign({},u),{},{username:l?"请输入正确的手机号":"请输入手机号"}),smsInputInterceptTime:Date.now()})}))}))},zt=function(e){var t=document.querySelectorAll(".yidun_modal"),n=function(e){var t,n=document.createElement("button");return n.style.position="absolute",n.style.top="15px",n.style.right="15px",n.style.fontSize="16px",n.innerText="✕",n.setAttribute("tabindex","0"),n.addEventListener("click",e),(t=n)&&(t.addEventListener("focus",(function(e){e.target.style.boxShadow="0 0 0 2px #ffffff, 0 0 0 4px rgb(0 102 255 / 30%)"}),!0),t.addEventListener("blur",(function(e){e.target.style.boxShadow="none"}),!0)),n}((function(){var t;return null===(t=e.current)||void 0===t?void 0:t.close()}));Array.from(t).forEach((function(e){e.appendChild(n),function(e){e.querySelector(".yidun_tips").removeAttribute("aria-live")}(e),function(e){var t=e.querySelector(".yidun_modal__title");t.setAttribute("tabindex","-1"),t.innerText="请完成安全验证，可使用语音验证",t.addEventListener("focus",(function(){t.style.outline="none"})),setTimeout((function(){t.focus()}),500)}(e)}))},qt=function(e){var t=e.customErrorInputMap,n=e.smsType,a=e.selectedCountry.code,r=e.username,o=e.testPhoneNo,i=e.captchaV2Ref,c=e.runBeforeResetValidateResult,s=e.setState,u=e.captchaNeeded,l=e.continueActionRef,d=Object(w.useDispatch)();return Object(rt.a)((function(e,h){return c((function(){var e;if(o()){var c=Ft(r,a).value,p=function(){d(Object(N.j)({username:c,smsType:n,type:"login"})),s({smsBackUpDisplay:!1})};if(!r||u){if(u&&null!==(e=i.current)&&void 0!==e&&e.required){i.current.show(),zt(i);return l.current=function(){p(),h()},!1}s({customErrorInputMap:Object.assign(Object.assign({},t),{},{username:r?"":"请输入手机号"})})}else p()}else s({customErrorInputMap:Object.assign(Object.assign({},t),{},{username:r?"请输入正确的手机号":"请输入手机号"}),smsInputInterceptTime:Date.now()})}),!u)}))},Lt={username:null,password:null,captcha:null,digits:null},Ht=function(e){var t=e.setState,n=Object(w.useDispatch)();return Object(rt.a)((function(e,a){return n(Object(N.f)()),t({customErrorInputMap:Object.assign({},Lt),validationResult:{needsRefresh:!1,timestamp:Date.now()}},e),a}))},Jt=function(e){var t=e.props,n=e.captchaV2Ref,a=t.captchaValidated,r=t.captchaNeeded;return Object(rt.a)((function(){if(!a&&r){var e;if(null!==(e=n.current)&&void 0!==e&&e.required)return n.current.show(),zt(n),Promise.resolve(!1);console.warn("Captcha is unavailable.")}return Promise.resolve(!0)}))},Kt=n(713),Zt=n(708),Wt=function(e){var t=e.registerConfirmSucceeded,n=e.loginConfirmSucceeded,a=e.sendDigitsError,r=e.nextUrl,o=e.username,i=e.isInSignPage,c=e.loginConfirmError,s=e.captchaValidationMessage,u=e.setState,d=e.loginUnregisteredError,h=e.loginBindWechatError,p=e.type,f=e.verification,g=Object(w.useDispatch)();Object(l.useEffect)((function(){!c||d||h||(g(Object(X.i)(p)),g(Object(X.d)()))}),[c,d,h,u,g,p]),Object(l.useEffect)((function(){if(s){var e=s?{smsInputInterceptTime:Date.now()}:{};u(Object.assign({captchaValidated:!1,captchaNeeded:!0},e))}}),[s,u]),Object(l.useEffect)((function(){(n||t)&&(Object(Zt.b)(o),null!=f&&f.isZombie&&Object(Kt.b)(f),r?location.href=r:i?location.href="/":location.reload())}),[n,t]),Object(l.useEffect)((function(){if(a||!1===n){var e=a?{smsInputInterceptTime:Date.now()}:{};u(Object.assign(Object.assign({},e),{},{captchaValidated:!1,captchaNeeded:!0}))}}),[a,n]),Object(l.useEffect)((function(){(s||a&&null===c)&&u({smsBackUpDisplay:!0})}),[s,a])},Yt="UPDATE_STATE",Gt=function(e){return{smsType:"text",smsBackUpName:"语音",smsBackUpDisplay:!0,reStartTime:-1,supportedCountriesShown:!1,selectedCountry:e.selectedCountry,username:e.username,password:e.password,fullname:"",customErrorInputMap:Object.assign({},Lt),submitDisabled:!1,lastSubmittedTimestamp:-1}},_t=function(e,t){var n=t.type,a=t.callback;if(n===Yt){var r=t.payload;return a&&a(e),Object.assign(Object.assign({},e),r)}return e},Xt=function(e){var t=e.props,n=e.captchaV2Ref,a=e.continueActionRef,r=e.setState,o=e.selectedCountry.code,i=e.username,c=e.fullname,s=e.digits,u=e.password,l=Object(w.useDispatch)(),d=Jt({props:t,captchaV2Ref:n});return Object(rt.a)((function(){var e=function(){l(Object(_.d)({source:"com.zhihu.web",registerType:"phone_digits",phoneNo:"".concat(o).concat(i),fullname:c,digits:s,password:u}))};a&&(a.current=e),r({submitDisabled:!0}),d().then((function(t){return t&&e()})).finally((function(){return r({submitDisabled:!1})}))}))},$t=function(e){var t=e.isInSignPage,n=e.type,a=e.isOversea,r=e.needSMSIdentify,o=e.captchaV2,i=e.registerConfirmSucceeded,c=e.loginConfirmSucceeded,s=e.nextUrl,d=e.captchaNeeded,h=e.loginUnregisteredError,f=e.loginConfirmError,g=e.captchaValidationMessage,b=e.showSwitchTypeIcon,m=e.isSignPage,A=e.selectClassName,v=e.verification,C=e.containerType,E=Object(w.useDispatch)(),O=Object(l.useReducer)(_t,e,Gt),y=Object(at.a)(O,2),S=y[0],j=y[1],I=S.selectedCountry,B=S.username,k=S.supportedCountriesShown,T=S.customErrorInputMap,Q=S.smsInputInterceptTime,R=S.smsType,P=S.reStartTime,M=S.password,x=S.smsBackUpDisplay,D=S.smsBackUpName,U=S.submitDisabled,F=S.captcha,V=S.fullname,z=S.digits,q=S.lastSubmittedTimestamp,H=Object(l.useRef)(null),J=Object(l.useRef)(null),K=Object(l.useRef)(null),Z=Object(p.k)().trackEvent,W=Object(rt.a)((function(){m||Z({block:"".concat(n,"_loginSuccess")})})),Y=Object(rt.a)((function(e,t){return j({type:Yt,payload:e,callback:t})})),_=xt(e),X=_.usernameServerError,ee=_.digitsServerError,te=_.passwordServerError,ne=_.undefinedLoginError,ae=_.undefinedDigitsError;Object(l.useEffect)((function(){(ne||ae)&&E(Object(ze.g)(ne||ae,"red"))}),[E,ne,ae]);var re=Mt({props:e,state:S,setState:Y,rootRef:K}),oe=Dt({setState:Y}),ie=Ut({state:S}),ce=Ht({setState:Y}),se=qt({customErrorInputMap:T,smsType:R,selectedCountry:I,username:B,runBeforeResetValidateResult:ce,testPhoneNo:ie,setState:Y,captchaNeeded:d,captchaV2Ref:J,continueActionRef:H}),ue=Jt({props:e,captchaV2Ref:J}),le=Vt({props:e,selectedCountry:I,captcha:F,setState:Y,runBeforeResetValidateResult:ce,runBeforeCheckCaptcha:ue,testPhoneNo:ie,continueActionRef:H,customErrorInputMap:T,username:B,trackLoginSuccess:W});Wt({registerConfirmSucceeded:i,loginConfirmSucceeded:c,nextUrl:s,username:B,isInSignPage:t,loginConfirmError:f,captchaValidationMessage:g,setState:Y,loginUnregisteredError:h,verification:v});var de=Xt({props:e,captchaV2Ref:J,continueActionRef:H,setState:Y,selectedCountry:I,username:B,fullname:V,digits:z,password:M});if(r)return Object(u.b)(ct,{ref:K,onBack:function(){return E(Object(N.f)())},phoneNo:"".concat(I.code).concat(B)});var he=null;if("qrcode"===n){var pe=Object(u.b)(p.f,{zaType:"Text",zaText:"二维码登录",extra:{configMap:{containerType:"登录页"}},children:Object(u.b)(L,{ref:K,isInSignPage:t,className:"SignInQrcode",onChangeType:function(){return re("password")},showSwitchTypeIcon:b,trackLoginSuccess:W})});he=m?pe:Object(u.b)(p.f,{zaType:"Popup",zaBlock:n,children:pe},n)}else if(h&&"digits"==n)he=Object(u.b)(bt,{handleRegister:de,setState:Y,submitDisabled:U,usernameServerError:X,passwordServerError:te});else{var fe=Object(u.c)($.b,{className:"SignFlow Login-content",onSubmit:le,children:[Object(u.b)(pt,{type:n,showSwitchTypeIcon:b}),Object(u.b)(gt,{type:n,isOversea:a,supportedCountriesShown:k,selectedCountry:I,username:B,usernameServerError:X,customErrorInputMap:T,targetClassName:"username-input"}),Object(u.b)(At,{type:n,smsInputInterceptTime:Q,digitsServerError:ee,smsType:R,reStartTime:P,passwordServerError:te,password:M,targetClassName:"username-input"}),Object(u.b)(vt,{type:n,isOverSea:a,smsBackUpName:D,smsBackUpDisplay:x,smsType:R,containerType:C}),Object(u.b)(Rt,{type:n,captchaV2Ref:J,lastSubmittedTimestamp:q}),Object(u.b)(Ct,{submitDisabled:U,type:n,containerType:C})]});he=m?Object(u.b)(p.f,{zaType:"Popup",zaBlock:n,children:fe},n):fe}return Object(u.b)(G.a,{handleChangeType:re,setState:Y,dispatch:j,selectClassName:A,handleChange:oe,testPhoneNo:ie,handleSendDigits:se,continueActionRef:H,captchaNeeded:d,captchaV2:o,children:he})};$t.propTypes={validateAndLogin:C.a.func,resetLoginValidateResult:C.a.func,validateSendDigits:C.a.func,loginConfirmSucceeded:C.a.bool,loginConfirmError:C.a.object,selectClassName:C.a.string,sendDigitsError:C.a.object,captchaValidationMessage:C.a.string,captchaNeeded:C.a.bool,selectedCountry:C.a.object,username:C.a.string,password:C.a.string,type:C.a.oneOf(["password","digits","qrcode"]),onChangeType:C.a.func,isInSignPage:C.a.bool,showSwitchTypeIcon:C.a.bool},$t.defaultProps={selectedCountry:{name:"中国",code:"+86"},username:"",password:""};var en=Object(w.connect)(st)($t),tn=n(286);function nn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var an=function(e){Object(i.a)(n,e);var t=nn(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={type:e.props.showQrcodeFirst?"qrcode":"digits",isOversea:!1,passwordType:"email"},e.handleSwitchLoginType=function(t){"email"!==t&&"oversea"!==t?(e.setState({type:t}),S.b.increment("logIn.type.switchTo.".concat(t,".count"),.001)):e.setState({type:"password",isOversea:"oversea"===t,passwordType:t})},e}return Object(o.a)(n,[{key:"renderNotification",value:function(){var e=this.props,t=e.notification,n=e.account,a=n.isAppealed,r=n.spamLevel,o=a||r?Ve.D:Ve.C,i=null;return i=6===r?Object.assign(Object.assign({},t),{},{theme:"red"}):t,Object(u.b)(tn.a,{notification:i.global,delay:o,className:"AppHeader-notification"})}},{key:"render",value:function(){var e=this.props,t=e.nextUrl,n=e.isInSignPage,a=e.showSwitchTypeIcon,r=e.isSignPage,o=e.selectClassName,i=void 0===o?"Select-popoverTarget":o,c=e.containerType,s=this.state,l=s.type,d=s.isOversea;return Object(u.c)(u.a,{children:[Object(u.b)(en,{containerType:c,type:l,isInSignPage:n,isOversea:d,onChangeType:this.handleSwitchLoginType,nextUrl:t,showSwitchTypeIcon:a,isSignPage:r,selectClassName:i}),this.renderNotification()]})}}]),n}(l.Component);an.propTypes={nextUrl:C.a.string,isInSignPage:C.a.bool,showSwitchTypeIcon:C.a.bool,selectClassName:C.a.string};var rn=Object(E.compose)(O.withRouter,Object(w.connect)((function(e,t){var n=t.showQrcode,a=void 0===n||n,r=t.showQrcodeFirst;return{showQrcodeFirst:a&&r,notification:e.notification,account:e.account,isSignPage:["/signin","/signup"].includes(t.router.location.pathname)}})))(an),on=n(1332),cn=Object.assign;function sn(e){return d.a.createElement(I.a,cn(cn({width:"24",height:"24",viewBox:"0 0 24 24","data-new-api":"Qq24","data-old-api":"Qq24"},e),{className:"ZDI ZDI--Qq24"+(e.className?" ".concat(e.className):"")}),d.a.createElement("path",{d:"M12.003 2c-2.265 0-6.29 1.364-6.29 7.325v1.195S3.55 14.96 3.55 17.474c0 .665.17 1.025.281 1.025.114 0 .902-.483 1.748-2.072 0 0-.18 2.197 1.904 3.967 0 0-1.77.495-1.77 1.182 0 .686 4.078.43 6.29 0 2.239.425 6.288.687 6.288 0 0-.688-1.77-1.182-1.77-1.182 2.086-1.77 1.906-3.967 1.906-3.967.845 1.588 1.634 2.072 1.746 2.072.111 0 .283-.36.283-1.025 0-2.514-2.165-6.954-2.165-6.954V9.325C18.29 3.364 14.268 2 12.003 2z",fillRule:"evenodd",clipRule:"evenodd"}))}var un=n(1354),ln=n(75),dn={sina:"Weibo",qq:"QQ",wechat:"Wechat"};function hn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var pn="/oauth/account_callback",fn={qqconn:"/oauth/redirect/login/qqconn?next=",sina:"/oauth/redirect/login/sina?next=",wechat:"/oauth/redirect/login/wechat?next="};function gn(e){return"sina"!==e||!/WindowsWechat/.test(navigator.userAgent)}var bn=function(e){Object(i.a)(n,e);var t=hn(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).handleCallbackMessage=function(t){var n=t.origin,a=t.data;/(\.)?(zhihu|vzuu)\.(com|dev)/.test(n)&&a&&(e.unsubscribeCallback(),e.accountCallback(a))},e.accountCallback=function(t){var n=e.props,a=n.onRegister,r=n.nextUrl,o=t.login,i=t.type,c=t.fullname,s=t.verification;null!=s&&s.isZombie&&Object(Kt.b)(s),o?(Object(Zt.b)(e.clickedServiceName),e.handleLogSocialLoginSuccess(),r?location.href=r:location.reload()):a({bySocial:!0,socialType:i,fullname:c})},e.handleBuildSocialAuthLink=function(t){e.clickedServiceName=t,e.handleLogSingleSocialButtonClick(t),S.b.increment("logIn.clickSocial.".concat(t,".count"),.1);var n=fn[t],a=Object(xe.c)(),r=a.utm_source,o=a.utm_medium;gn(t)?(e.subscribeCallback(),window.open("https://www.zhihu.com".concat(n).concat(pn).concat(r?"&utm_source=".concat(r):"","&ref_source=").concat(o),"_blank","top=200,left=400,width=600,height=550,directories=no,menubar=no,toolbar=no")):location.href="https://www.zhihu.com".concat(n).concat(pn,"&from=").concat(encodeURIComponent(e.parseNextInfoFromUrl()))},e.handleEntranceButtonClick=function(t){e.props.onEntranceButtonClick&&e.props.onEntranceButtonClick(t),e.handleLogSocialLogin(),e.setState((function(e){return{socialButtonExpanded:!e.socialButtonExpanded}}))},e.parseNextInfoFromUrl=function(){var t=e.props.router.location.query.next,n="/";if(t)try{n=decodeURIComponent(t)}catch(e){n=unescape(t)}return n},e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){if(document.referrer.startsWith("https://www.zhihu.com/oauth/callback/sina")){var e=Me.a.get("atoken"),t=Me.a.get("accountcallback");if(e&&t){var n=JSON.parse(decodeURIComponent(t));if(!n)return;var a=n.fullname,r=n.type;(0,this.props.onRegister)({fullname:a,socialType:r})}}}},{key:"componentWillUnmount",value:function(){this.unsubscribeCallback()}},{key:"subscribeCallback",value:function(){window.addEventListener("message",this.handleCallbackMessage,!1),window.NWEB={accountCallback:this.accountCallback},this.domain=document.domain,document.domain="zhihu.com"}},{key:"unsubscribeCallback",value:function(){if(window.removeEventListener("message",this.handleCallbackMessage,!1),window.NWEB&&"www.zhihu.com"===location.host){try{document.domain=this.domain}catch(e){}delete window.NWEB}}},{key:"handleLogSocialLogin",value:function(){A.a.trackEvent(this,{action:"Click",element:"Button",element_name:"SNSSignIn"})}},{key:"handleLogSingleSocialButtonClick",value:function(e){var t,n,a,r;t=this,n="SignIn",a={type:dn[e]},A.a.trackEvent(t,{action:n,element:"Button",element_name:r},{account:a})}},{key:"handleLogSocialLoginSuccess",value:function(){var e,t,n,a,r=this.props,o=r.router,i=r.trackEvent;["/signin","/signup"].includes(o.location.pathname)||i({block:"".concat(this.clickedServiceName,"_loginSuccess")}),e=this,t="SignIn",n=this.clickedServiceName,A.a.trackEvent(e,{id:236,action:"StatusReport",element_name:a},{status:{result:"Success",event:{action:t,element:"Button"}},account:n})}},{key:"render",value:function(){var e=this;return Object(u.b)("div",{className:"Login-socialLogin",children:Object(u.c)("span",{className:"Login-socialButtonGroup",children:[Object(u.b)(p.a,{as:Y.c,zaText:"微信第三方登录",zaType:"Button",zaAction:"OpenUrl",extra:{link:{url:"https://open.weixin.qq.com/connect/qrconnect"}},className:"Login-socialButton",preset:"plain",onClick:function(){return e.handleBuildSocialAuthLink("wechat")},children:Object(u.b)(on.b,{})}),Object(u.b)(p.a,{as:Y.c,zaText:"QQ第三方登录",zaType:"Button",zaAction:"OpenUrl",extra:{link:{url:"https://graph.qq.com/oauth2.0/show"}},className:"Login-socialButton",preset:"plain",onClick:function(){return e.handleBuildSocialAuthLink("qqconn")},children:Object(u.b)(sn,{fill:"#50C8FD"})}),Object(u.b)(p.a,{as:Y.c,zaText:"微博第三方登录",zaType:"Button",zaAction:"OpenUrl",extra:{link:{url:"https://api.weibo.com/oauth2/authorize"}},className:"Login-socialButton",preset:"plain",onClick:function(){return e.handleBuildSocialAuthLink("sina")},children:Object(u.b)(un.b,{})})]})})}}]),n}(l.Component);bn.propTypes={onRegister:C.a.func.isRequired,onEntranceButtonClick:C.a.func};var mn=Object(E.compose)(O.withRouter,D)(bn);function An(e){var t=Object(ln.b)();return/bux/.test(t.origin)?null:Object(u.b)(mn,Object.assign({},e))}function vn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var Cn=function(e){Object(i.a)(n,e);var t=vn(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={showHeader:!0,fullname:"",socialType:""},e.changeSignType=function(t){e.props.onChangeSignType(t),e.handleSetShowHeader(!0)},e.handleSetShowHeader=function(t){e.setState({showHeader:t})},e.handleSocialRegister=function(t){var n=t.fullname,a=t.socialType;e.props.onChangeSignType("register"),e.setState({fullname:n,socialType:a,showHeader:!1})},e.handleResetRegister=function(){e.props.onChangeSignType("login"),e.setState({fullname:"",socialType:"",showHeader:!0})},e.renderLine=function(){return Object(u.c)(y.Flex,{css:{margin:"0 24px 12px",alignItems:"center"},children:[Object(u.b)(y.Box,{sx:{borderTop:"1px solid",borderColor:"GBK09A",width:"124px"}}),Object(u.b)(y.Text,{color:"GBK06A",fontSize:12,mx:16,width:72,overflow:"hidden",lineHeight:"17px",css:{whiteSpace:"nowrap"},children:"其他方式登录"}),Object(u.b)(y.Box,{sx:{borderTop:"1px solid",borderColor:"GBK09A",width:"124px"}})]})},e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.nextUrl;e.isLogin&&(location.href=t||"/")}},{key:"render",value:function(){var e=this.state,t=e.fullname,n=e.socialType,a=this.props,r=a.nextUrl,o=a.isInSignPage,i=a.signType,c=a.showQrcodeFirst,s=a.showSwitchTypeIcon,l=a.containerType,d=o?y.Card:y.Box;return Object(u.c)(d,{bg:"background",width:400,css:{overflow:"hidden",boxShadow:"none"},children:["login"===i?Object(u.b)("div",{className:"SignContainer-content",children:Object(u.b)("div",{className:"SignContainer-inner",children:Object(u.b)(rn,{containerType:l,showQrcodeFirst:c,nextUrl:r,isInSignPage:o,showSwitchTypeIcon:s})})}):Object(u.b)(nt,{socialType:n,nextUrl:r,defaultFullname:t,onResetRegister:this.handleResetRegister}),"login"===i&&Object(u.c)(u.a,{children:[this.renderLine(),Object(u.b)(An,{onRegister:this.handleSocialRegister}),Object(u.c)("div",{className:"SignContainer-tip",children:[P.a.allowSignUp?"未注册手机验证后自动登录，注册即代表同意":"手机验证后自动登录，登录即代表同意",Object(u.b)("a",{href:"https://www.zhihu.com/term/zhihu-terms",children:"《知乎协议》"}),Object(u.b)("a",{href:"https://www.zhihu.com/term/privacy",children:"《隐私保护指引》"})]})]})]})}}]),n}(l.Component),En=Object(Z.a)(Cn),wn=["signType","handleQRCodeLinkClick","isInSignPage","showQrcode"];function On(e){var t=e.signType,n=e.handleQRCodeLinkClick,r=e.isInSignPage,o=e.showQrcode,i=Object(a.default)(e,wn);return Object(u.c)("div",{className:"signQr-container",children:[Object(u.c)("div",{className:"signQr-leftContainer",children:[Object(u.b)(L,{className:"smallVersion",showSwitchTypeIcon:!1}),Object(u.b)(K,{zaClickId:r?4943:8270,isQRCodeShown:o,onQRCodeLinkClick:function(e){n(!o),r?o&&A.a.trackEvent(e.currentTarget,{id:4945}):A.a.trackEvent(e.currentTarget,{id:o?8272:8271})}})]}),Object(u.b)("div",{className:"signQr-rightContainer",children:Object(u.b)(En,Object.assign({signType:t,showSwitchTypeIcon:!1,isInSignPage:r},i))})]})}var yn=["onClose","showQrcodeFirst","titlePart"];function Sn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var jn=function(e){Object(i.a)(n,e);var t=Sn(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={signType:e.props.signType||"login",showQrcode:!1},e.handleChangeSignType=function(t){e.setState({signType:t})},e.handleToggleQrcode=function(t){e.setState({showQrcode:t})},e.handleCloseQrcode=function(){e.setState({showQrcode:!1})},e}return Object(o.a)(n,[{key:"render",value:function(){var e=this.props,t=e.onClose,n=e.showQrcodeFirst,r=e.titlePart,o=Object(a.default)(e,yn),i=this.state,c=i.signType,s=i.showQrcode;return Object(u.b)(p.b,{block:"signModal",children:Object(u.b)(p.f,{zaType:"Popup",zaBlock:c,children:Object(u.b)(h.b,Object.assign(Object.assign({className:"signFlowModal",onClose:t},o),{},{children:Object(u.c)(p.f,{zaType:"Popup",zaText:"登录框曝光",children:[r,Object(u.c)("div",{className:"signFlowModal-container",children:[Object(u.b)(On,{containerType:"SignContainerModal",showQrcodeFirst:n,signType:c,onChangeSignType:this.handleChangeSignType,showQrcode:s,handleQRCodeLinkClick:this.handleToggleQrcode}),Object(u.c)("div",{className:g()("SignFlowQRImage noArrow",{"SignFlowQRImage--isHidden":!s}),children:[Object(u.b)("p",{className:"SignFlowQRImage-title",children:"扫码下载知乎 App"}),Object(u.b)("div",{className:"smallSize"}),Object(u.c)("button",{className:"SignFlowQRImage-closeButton",onClick:this.handleCloseQrcode,children:[Object(u.b)(b.a,{}),"关闭二维码"]})]})]})]})}))})})}}]),n}(l.Component)},1853:function(e,t,n){"use strict";n.r(t),n.d(t,"CONFIRM_BIND_PHONE",(function(){return G})),n.d(t,"BIND_PHONE",(function(){return _})),n.d(t,"LOGIN_WITH_PHONE",(function(){return X})),n.d(t,"NEED_UNBIND",(function(){return $})),n.d(t,"CONFIRM_UNBIND",(function(){return ee})),n.d(t,"SAFETY_VERIFICATION",(function(){return te}));var a,r=n(12),o=n(13),i=n(14),c=n(15),s=n(6),u=n(0),l=n(2),d=n.n(l),h=n(1),p=n(23),f=n(10),g=n(484),b=n(127),m=n(4),A=n(18),v=n(70),C=n(17),E=n(1399),w=n(1419),O=n(1460),y=n(103),S=n(11),j=n(24),I=n(1559),B=n(1496),k=n(1420),T=["countDownEvent","startAtOnce","interceptTime","resetText","manualValidateError","onChange","validations","countDownEndEvent","reStartTime","isIOS"];function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var R=function(e){Object(i.a)(n,e);var t=Q(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var e=this.props,t=e.countDownEvent,n=e.startAtOnce,r=e.interceptTime,o=e.resetText,i=e.manualValidateError,c=e.onChange,s=e.validations,l=e.countDownEndEvent,d=e.reStartTime,h=e.isIOS,p=Object(j.default)(e,T);return Object(u.c)("div",{className:"SignFlow SignFlow-smsBindPhoneInputContainer",children:[Object(u.b)(k.a,Object.assign({name:"digits",className:"SignFlow-smsBindPhoneInput",type:h?"tel":"number",errorMessageClassName:"SignFlow-smsBindPhoneInputErrorMask",placeholder:"输入 6 位验证码",manualValidateError:i,onChange:c,validations:[{type:"required",message:"请填写验证码",className:"SignFlow-smsInputBindPhoneRequiredErrorMask"}].concat(Object(S.a)(s||[]))},p)),Object(u.b)(I.a,{className:"SignFlow-smsBindPhoneInputButton",preset:"plain",initialText:"发送验证码",resetText:o,countingText:Object(B.a)(a||(a=Object(y.a)(["","s 后可重发"])),"count"),startAtOnce:n,event:t,countDownEndEvent:l,interceptTime:r,reStartTime:d})]})}}]),n}(h.Component);R.propTypes={countDownEvent:d.a.func.isRequired,startAtOnce:d.a.bool,interceptTime:d.a.number,resetText:d.a.string,manualValidateError:d.a.string},R.defaultProps={startAtOnce:!1,resetText:"重发验证码"};var N=Object(f.connect)((function(e){return{isIOS:e.env.userAgent.iOS}}))(R),P=n(26);function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var x=function(e){Object(i.a)(n,e);var t=M(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={selectedCountry:{code:"+86",name:"中国"},phoneNo:null,smsInputInterceptTime:-1,manualError:null,showFooter:!1,sendValidationCodeButtonText:"发送验证码",identifyingCodeError:null},e.testPhoneNo=function(){var t=e.state,n=t.selectedCountry.code,a=t.phoneNo;return"+86"!==n||/^\d{11}$/.test(a)},e.handleChange=function(t){return function(n){e.setState(Object(m.a)({},t,n))}},e.handleSendDigits=function(t){var n=e.props.requestPhoneVerificationCode,a=e.state,r=a.selectedCountry.code,o=a.phoneNo,i=a.manualError;if(C.a.trackEvent(t.target,{action:"GetCaptcha"}),e.testPhoneNo())return n("".concat(r).concat(o)).then((function(){e.setState({manualError:null})})).catch((function(t){var n=t.payload,a=(n=void 0===n?{}:n).message;return e.setState({manualError:a,smsInputInterceptTime:Date.now()})}));return e.setState({manualError:"请输入正确的手机号"===i?" ".concat("请输入正确的手机号"):"请输入正确的手机号",smsInputInterceptTime:Date.now()})},e.handleSubmit=function(t){var n=t.phoneNo,a=t.digits,r=e.props,o=r.updatePhoneNumber,i=r.onSuccess,c=r.onNeedUnbind,s=e.state,u=s.selectedCountry.code,l=s.identifyingCodeError;o("".concat(u).concat(n),a).then((function(e){var t=e.payload,a=t.data;if(t.success)return i();var r=a.bindedAccountFullname,o=a.requestAccountFullname;return c({phoneNumber:n,bindName:r,requiredName:o})})).catch((function(t){var n=t.payload,a=(n=void 0===n?{}:n).code,r=n.message;a===P.t&&e.setState({identifyingCodeError:l===r?" ".concat(r):r})}))},e.handleZaOK=function(e){C.a.trackEvent(e.target,{action:"Ok"})},e.renderContent=function(){var t=e.state,n=t.smsInputInterceptTime,a=t.manualError,r=t.sendValidationCodeButtonText,o=t.identifyingCodeError;return Object(u.b)("div",{ref:function(t){e.container=t},children:Object(u.c)(w.b,{className:"SignFlow BindPhoneForm",onSubmit:e.handleSubmit,children:[void 0,Object(u.b)(E.a,{selectClassName:"BindPhone-select",children:Object(u.b)(O.a,{type:"register",supportedCountriesShown:!0,manualValidateError:a,onSelect:e.handleChange("selectedCountry"),onChange:e.handleChange("phoneNo")})}),Object(u.b)(N,{resetText:r,interceptTime:n,countDownEvent:e.handleSendDigits,manualValidateError:o},"sms-input"),Object(u.b)("div",{className:"BindPhone-helpWrapper",children:Object(u.b)(A.c,{className:"BindPhone-helpText",preset:"link",onClick:function(){e.setState({showFooter:!0})},children:"需要帮助？"})}),Object(u.b)(A.c,{css:{display:"block",width:"220px",margin:"55px auto 0"},preset:"primary",color:"blue",type:"submit",onClick:e.handleZaOK,children:"确认"})]})})},e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){C.a.setModule(this.container,{module:"BindPhoneForm"}),C.a.trackCardShow(this.container)}},{key:"render",value:function(){var e=this.props.onClose,t=this.state.showFooter;return Object(u.b)(v.b,{title:"设置手机号",subtitle:"绑定手机后，你就可以使用知乎的提问、回答、评论等功能。",footer:t?"如需要帮助，请联系 i@zhihu.com，我们会尽快帮你解决":null,onClose:e,size:"default",children:this.renderContent()})}}]),n}(h.Component);x.propTypes={requestPhoneVerificationCode:d.a.func.isRequired,updatePhoneNumber:d.a.func.isRequired,onClose:d.a.func.isRequired,onSuccess:d.a.func.isRequired,onNeedUnbind:d.a.func.isRequired};var D=n(106);function U(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var F=function(e){Object(i.a)(n,e);var t=U(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).zaKnowMore=function(e){C.a.trackEvent(e.target,{action:"OpenUrl",name:"了解更多"})},e.toBindPhone=function(t){var n=e.props.onBindPhone;C.a.trackEvent(t.target,{action:"OpenUrl",name:"去绑定手机"}),n()},e.handleClose=function(t){var n=e.props,a=n.onClose,r=n.config.canWrite;C.a.trackEvent(t.target,{action:"Cancel",name:r?"暂不绑定":"取消"}),a()},e.renderContent=function(){var t=e.props.config,n=t.tip,a=t.canWrite;return Object(u.c)("div",{ref:function(t){e.container=t},children:[Object(u.c)("p",{children:[n,Object(u.b)(D.a,{preset:"link",target:"_blank",href:"https://zhuanlan.zhihu.com/p/27257715",onClick:e.zaKnowMore,children:"了解更多"})]}),Object(u.c)("div",{className:"BindPhone-buttonSection",children:[Object(u.b)(D.a,{className:"BindPhone-button",onClick:e.handleClose,children:a?"暂不绑定":"取消"}),Object(u.b)(A.c,{className:"BindPhone-button",preset:"primary",color:"blue",onClick:e.toBindPhone,children:"去绑定手机"})]})]})},e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){C.a.setModule(this.container,{module:"BindPhoneForm"}),C.a.trackCardShow(this.container)}},{key:"render",value:function(){var e=this.props.onClose;return Object(u.b)(v.b,{className:void 0,title:"绑定手机",onClose:e,size:"default",children:this.renderContent()})}}]),n}(h.Component);function V(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}F.propTypes={config:d.a.object,onClose:d.a.func,onBindPhone:d.a.func};var z=function(e){Object(i.a)(n,e);var t=V(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).handleCancel=function(t){var n=e.props.onClose;C.a.trackEvent(t.target,{action:"Cancel",name:"不绑定"}),n()},e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){C.a.setModule(this.container,{module:"BindMailForm"}),C.a.trackCardShow(this.container)}},{key:"render",value:function(){var e=this,t=this.props.onClose;return Object(u.b)(v.b,{className:void 0,title:"手机号绑定成功",onClose:t,size:"default",children:Object(u.c)("div",{ref:function(t){e.container=t},children:[Object(u.b)("p",{children:"由于你此前绑定的邮箱未经验证，未来请使用手机号登录知乎。"}),Object(u.b)(A.c,{className:"BindPhone-remindLoginWithPhoneButton",onClick:this.handleCancel,preset:"primary",color:"blue",children:"知道了"})]})})}}]),n}(h.Component);function q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}z.propTypes={onClose:d.a.func};var L=function(e){Object(i.a)(n,e);var t=q(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).handleCancel=function(t){var n=e.props.onCancel;C.a.trackEvent(t.target,{action:"Click",name:"暂不绑定"}),n()},e.handleConfirm=function(t){var n=e.props.onConfirm;C.a.trackEvent(t.target,{action:"Click",name:"确认解绑"}),n()},e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){C.a.setModule(this.container,{module:"BindPhoneFailForm"}),C.a.trackCardShow(this.container)}},{key:"render",value:function(){var e=this,t=this.props,n=t.onClose,a=t.phoneNumber,r=t.bindName,o=t.requiredName;return Object(u.b)(v.b,{className:void 0,title:"绑定失败",onClose:n,size:"default",children:Object(u.c)("div",{ref:function(t){e.container=t},children:[Object(u.c)("p",{children:["你所输入的手机号 ",a," 已经被绑定到帐号「",r,"」。"]}),void 0,Object(u.c)("p",{children:["你可以选择将该手机号从该帐号中解绑，并绑定至当前帐号「",o,"」。"]}),void 0,Object(u.b)("p",{children:Object(u.c)("b",{children:["解绑后，你将无法再通过手机号登录原帐号「",r,"」。"]})}),Object(u.c)("div",{className:"BindPhone-buttonSection",children:[Object(u.b)(A.c,{className:"BindPhone-button",onClick:this.handleConfirm,children:"确认解绑"}),Object(u.b)(A.c,{className:"BindPhone-button",preset:"primary",color:"blue",onClick:this.handleCancel,children:"暂不绑定"})]})]})})}}]),n}(h.Component);function H(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}L.propTypes={onClose:d.a.func.isRequired,onCancel:d.a.func.isRequired,onConfirm:d.a.func.isRequired,phoneNumber:d.a.string.isRequired,bindName:d.a.string.isRequired,requiredName:d.a.string.isRequired};var J=function(e){Object(i.a)(n,e);var t=H(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).handleUnbind=function(t){var n=e.props,a=n.onSuccess,r=n.monopolizePhoneNumber,o=n.showNotification;C.a.trackEvent(t.target,{action:"Click",name:"确认解绑"}),r().then((function(){return o("绑定成功！","white"),a()}))},e.handleCancel=function(t){var n=e.props.onCancel;C.a.trackEvent(t.target,{action:"Click",name:"暂不绑定"}),n()},e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){C.a.setModule(this.container,{module:"BindPhoneVerifyForm"}),C.a.trackCardShow(this.container)}},{key:"render",value:function(){var e=this,t=this.props,n=t.onClose,a=t.bindName;return Object(u.b)(v.b,{className:void 0,title:"解绑手机",onClose:n,size:"default",children:Object(u.c)("div",{ref:function(t){e.container=t},children:[Object(u.b)("p",{children:Object(u.b)("b",{children:"解绑操作无法撤销。"})}),void 0,Object(u.c)("p",{children:["如果你没有其他登录方式，你将无法再使用帐号「",a,"」。"]}),Object(u.c)("div",{className:"BindPhone-buttonSection",children:[Object(u.b)(A.c,{className:"BindPhone-button",onClick:this.handleUnbind,children:"确认解绑"}),Object(u.b)(A.c,{className:"BindPhone-button",preset:"primary",color:"blue",onClick:this.handleCancel,children:"暂不绑定"})]})]})})}}]),n}(h.Component);J.propTypes={onClose:d.a.func.isRequired,onSuccess:d.a.func.isRequired,onCancel:d.a.func.isRequired,bindName:d.a.string.isRequired,showNotification:d.a.func.isRequired,monopolizePhoneNumber:d.a.string.isRequired};var K=n(298),Z=n(43),W=n(37);function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=Object(s.a)(e);if(t){var r=Object(s.a)(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Object(c.a)(this,n)}}var G="CONFIRM_BIND_PHONE",_="BIND_PHONE",X="LOGIN_WITH_PHONE",$="NEED_UNBIND",ee="CONFIRM_UNBIND",te="SAFETY_VERIFICATION",ne=function(e){Object(i.a)(n,e);var t=Y(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={},e.handleBindPhoneSuccess=function(){var t=e.props,n=t.needShowLoginWithPhoneNumber,a=t.showNotification,r=t.onToggle,o=t.onSuccess;return null==o||o(),n?e.goToStep(X)():(a("绑定成功！","white"),setTimeout((function(){return location.reload()}),2e3),r())},e.handleNeedUnbind=function(t){var n=t.bindName,a=t.phoneNumber,r=t.requiredName;return e.setState({bindName:n,phoneNumber:a,requiredName:r,step:$})},e.goToStep=function(t){return function(){return e.setState({step:t})}},e.handleCloseWithReload=function(){return location.reload()},e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){(0,this.props.fillCurrentUserIfNeeded)(["email","isActive"])}},{key:"componentDidUpdate",value:function(e){e.currentStep!==this.props.currentStep&&this.goToStep(this.props.currentStep)()}},{key:"render",value:function(){var e=this,t=this.props,n=t.shown,a=t.requestPhoneVerificationCode,r=t.updatePhoneNumber,o=t.monopolizePhoneNumber,i=t.showNotification,c=t.config,s=t.account,l=t.unlockTicketByDigits,d=t.requestUnlockTicket,h=t.unlockTicketByPassword,p=t.onToggle,f=t.isBindPhone,b=t.isZombie,m=t.onSuccess,A=this.state,v=A.step,C=A.bindName,E=A.phoneNumber,w=A.requiredName;return n?v===G?Object(u.b)(F,{onBindPhone:this.goToStep(te),onClose:p,config:c}):v===_?Object(u.b)(x,{onClose:p,onSuccess:this.handleBindPhoneSuccess,onNeedUnbind:this.handleNeedUnbind,requestPhoneVerificationCode:a,updatePhoneNumber:r}):v===X?Object(u.b)(z,{onClose:this.handleCloseWithReload}):v===$?Object(u.b)(L,{onClose:p,onCancel:this.goToStep(_),onConfirm:this.goToStep(ee),bindName:C,phoneNumber:E,requiredName:w}):v===ee?Object(u.b)(J,{onClose:p,onSuccess:this.handleBindPhoneSuccess,onCancel:this.goToStep(_),bindName:C,monopolizePhoneNumber:o,showNotification:i}):v===te?Object(u.b)(g.a,{isShown:!0,account:s,unlockTicketByDigits:l,requestUnlockTicket:d,unlockTicketByPassword:h,onClose:p,onSuccess:function(){b&&f||e.goToStep(_)(),null==m||m()},zaModuleName:"BindMailForm"}):null:null}}]),n}(h.Component);ne.propTypes={shown:d.a.bool.isRequired,onToggle:d.a.func.isRequired,needShowLoginWithPhoneNumber:d.a.bool.isRequired,config:d.a.object.isRequired,requestPhoneVerificationCode:d.a.func.isRequired,updatePhoneNumber:d.a.func.isRequired,monopolizePhoneNumber:d.a.func.isRequired,onSuccess:d.a.func};t.default=Object(p.compose)(b.a,Object(f.connect)((function(e,t){var n=e.account,a=t.currentUser,r=a.isActive,o=a.email,i=a.isZombie,c=a.isBindPhone;return{account:n,hasActiveEmail:r&&o,needShowLoginWithPhoneNumber:!r&&!!o,config:P.I,isZombie:i,isBindPhone:c}}),{requestPhoneVerificationCode:K.g,updatePhoneNumber:K.k,monopolizePhoneNumber:K.e,showNotification:W.g,getUnlockRequest:K.d,unlockTicketByDigits:K.i,requestUnlockTicket:K.h,unlockTicketByPassword:K.j,fillCurrentUserIfNeeded:Z.d}))(ne)}}]);
//# sourceMappingURL=column.signflow.9f5d2ad6e7632072636a.js.map